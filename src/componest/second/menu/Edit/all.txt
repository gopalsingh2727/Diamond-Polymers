import React, { useEffect, useState, useCallback } from "react";
import "./EditProductCategoris.css";
import { useDispatch, useSelector } from "react-redux";
import { getAllProductTypesWithProducts } from "../../../../redux/create/products/productCategories/productCategoriesActions";
import { RootState } from "../../../../redux/rootReducer";
import { AppDispatch } from "../../../../../store";

interface Product {
  _id: string;
  productName: string;
  price: number;
  sizeX: number;
  sizeY: number;
  sizeZ: number;
}

interface ProductType {
  _id: string;
  productTypeName: string;
  description: string;
  products: Product[];
  createdAt: string;
  updatedAt: string;
  branchId: {
    _id: string;
    name: string;
  };
}

const EditProductCategories: React.FC = () => {
  const dispatch = useDispatch<AppDispatch>();

  const {
    items: productTypes = [],
    loading,
    error,
  } = useSelector((state: RootState) => state.productTypeWithProductsReducer || {});

  const [selectedRow, setSelectedRow] = useState(0);
  const [showDetail, setShowDetail] = useState(false);
  const [editType, setEditType] = useState("");
  const [editDescription, setEditDescription] = useState("");

  const selectedItem: ProductType | null = productTypes?.[selectedRow] || null;

  const handleKeyDown = useCallback(
    (e: KeyboardEvent) => {
      if (showDetail || productTypes.length === 0) return;

      if (e.key === "ArrowDown") {
        setSelectedRow((prev) => Math.min(prev + 1, productTypes.length - 1));
      } else if (e.key === "ArrowUp") {
        setSelectedRow((prev) => Math.max(prev - 1, 0));
      } else if (e.key === "Enter") {
        const selected = productTypes[selectedRow];
        if (selected) {
          setEditType(selected.productTypeName);
          setEditDescription(selected.description);
          setShowDetail(true);
        }
      }
    },
    [productTypes, selectedRow, showDetail]
  );

  useEffect(() => {
    dispatch(getAllProductTypesWithProducts());
  }, [dispatch]);

  useEffect(() => {
    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [handleKeyDown]);

  const handleEditChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setEditType(e.target.value);
  };

  const handleDescriptionChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
    setEditDescription(e.target.value);
  };

  const handleEditSave = () => {
    alert("Product Type updated! (not saved to DB)");
  };

  return (
    <div className="EditMachineType">
       {loading && <p className="loadingAndError">Loading...</p>}
      {error && <p className="loadingAndError"  style={{ color: "red" }}>{error}</p>}

      {!showDetail && !loading && productTypes.length > 0 ? (
        <table>
          <thead>
            <tr>
              <th>No</th>
              <th>Product Type</th>
              <th>Total Products</th>
              <th>Branch</th>
              <th>Created</th>
              <th>Updated</th>
              <th>Edit</th>
            </tr>
          </thead>
          <tbody>
            {productTypes.map((item: ProductType, index: number) => (
              <tr
                key={item._id}
                className={selectedRow === index ? "bg-blue-100" : ""}
              >
                <td>{index + 1}</td>
                <td>{item.productTypeName}</td>
                <td>{item.products?.length ?? 0}</td>
                <td>{item.branchId?.name || "N/A"}</td>
                <td>{new Date(item.createdAt).toLocaleString()}</td>
                <td>{new Date(item.updatedAt).toLocaleString()}</td>
                <td
                  className="text-blue-600 emt-edit-text"
                  onClick={() => {
                    setSelectedRow(index);
                    setEditType(item.productTypeName);
                    setEditDescription(item.description);
                    setShowDetail(true);
                  }}
                >
                  Edit
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      ) : showDetail && selectedItem ? (
        <div className="detail-container">
          <div className="TopButtonEdit">
            <button onClick={() => setShowDetail(false)}>Back</button>
            <button onClick={handleEditSave} className="Delete">Delete</button>
          </div>

          <div className="form-section">
            <label>Product Type:</label>
            <input type="text" value={editType} onChange={handleEditChange} />
          </div>

          <div className="form-section">
            <label>Description:</label>
            <textarea
              value={editDescription}
              onChange={handleDescriptionChange}
              rows={3}
            />
          </div>

          <button
            onClick={handleEditSave}
            className="save-button"
            disabled={
              editType === selectedItem.productTypeName &&
              editDescription === selectedItem.description
            }
          >
            Save
          </button>

          <div className="info-section">
            <p>
              <strong>Total Products:</strong> {selectedItem.products?.length ?? 0}
            </p>
            <p>
              <strong>Branch:</strong> {selectedItem.branchId?.name ?? "N/A"}
            </p>
            <p>
              <strong>Created At:</strong> {new Date(selectedItem.createdAt).toLocaleString()}
            </p>
            <p>
              <strong>Updated At:</strong> {new Date(selectedItem.updatedAt).toLocaleString()}
            </p>
          </div>

          <table className="machine-details-table">
            <thead>
              <tr>
                <th>Product Name</th>
                <th>Price</th>
                <th>Size X</th>
                <th>Size Y</th>
                <th>Size Z</th>
              </tr>
            </thead>
            <tbody>
              {selectedItem?.products.map((p: Product) => (
                <tr key={p._id}>
                  <td>{p.productName}</td>
                  <td>{p.price}</td>
                  <td>{p.sizeX}</td>
                  <td>{p.sizeY}</td>
                  <td>{p.sizeZ}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      ) : (
        !loading && <p>No product types available.</p>
      )}
    </div>
  );
};

export default EditProductCategories;import React, { useEffect, useState } from "react";
import { useDispatch, useSelector } from "react-redux";
import {
  getProducts,
  updateProduct,
  deleteProduct,
} from "../../../../redux/create/products/ProductActions";
import { getProductCategories } from "../../../../redux/create/products/productCategories/productCategoriesActions";
import { RootState } from "../../../../redux/rootReducer";

interface ProductType {
  _id: string;
  name?: string;
}

interface BranchId {
  _id: string;
  name?: string;
}

interface Product {
  _id: string;
  productName: string;
  sizeX: number;
  sizeY: number;
  sizeZ: number;
  productType?: ProductType | string;
  branchId?: BranchId | string;
}

interface ProductCategory {
  _id: string;
  name: string;
}

const EditProducts: React.FC = () => {
  const dispatch = useDispatch();

  const { products = [], loading, error } = useSelector(
    (state: RootState) => state.productList || {}
  );
  const productCategoryState = useSelector(
    (state: RootState) => state.productCategories || {}
  );
  const productCategories = (productCategoryState as any).items || (productCategoryState as any).categories || (productCategoryState as any).data || [];
  const { success: updateSuccess } = useSelector(
    (state: RootState) => state.productUpdate || {}
  );
  const { success: deleteSuccess } = useSelector(
    (state: RootState) => state.productDelete || {}
  );

  const [focusedRow, setFocusedRow] = useState<number>(-1);
  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);
  const [editForm, setEditForm] = useState({
    name: "",
    sizeX: "",
    sizeY: "",
    sizeZ: "",
    categoryId: "",
  });

  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const [deleteInput, setDeleteInput] = useState("");

  useEffect(() => {
    dispatch(getProducts() as any);
    dispatch(getProductCategories() as any);
  }, [dispatch, updateSuccess, deleteSuccess]);

  const handleKeyDown = (
    e: React.KeyboardEvent<HTMLTableRowElement>,
    product: Product
  ) => {
    if (e.key === "Enter") openEditor(product);
    else if (e.key === "ArrowDown")
      setFocusedRow((prev) => Math.min(prev + 1, products.length - 1));
    else if (e.key === "ArrowUp")
      setFocusedRow((prev) => Math.max(prev - 1, 0));
  };

  const openEditor = (product: Product) => {
    setSelectedProduct(product);
    setEditForm({
      name: product.productName,
      sizeX: product.sizeX.toString(),
      sizeY: product.sizeY.toString(),
      sizeZ: product.sizeZ.toString(),
      categoryId: typeof product.productType === 'object' ? product.productType?._id || "" : product.productType || "",
    });
  };

  const handleEditChange = (field: keyof typeof editForm, value: string) => {
    setEditForm({ ...editForm, [field]: value });
  };

  const handleUpdate = () => {
    if (!selectedProduct) return;

    dispatch(
      updateProduct(selectedProduct._id, {
        productName: editForm.name,
        productType: editForm.categoryId,
        sizeX: Number(editForm.sizeX),
        sizeY: Number(editForm.sizeY),
        sizeZ: Number(editForm.sizeZ),
      }) as any
    );
    setSelectedProduct(null);
  };

  const handleDeleteClick = () => {
    setDeleteInput("");
    setShowDeleteConfirm(true);
  };

  const confirmDelete = () => {
    if (deleteInput === "DELETE" && selectedProduct) {
      dispatch(deleteProduct(selectedProduct._id) as any);
      setShowDeleteConfirm(false);
      setSelectedProduct(null);
    } else {
      alert("❌ Type DELETE to confirm deletion");
    }
  };

  const cancelDelete = () => setShowDeleteConfirm(false);

  return (
    <div className="EditProducts p-4">
      <h2 className="text-xl font-semibold mb-4">Product List</h2>

      {loading && <p>Loading...</p>}
      {error && <p className="text-red-500">{error}</p>}

      {!selectedProduct ? (
        <table className="w-full border border-collapse">
          <thead className="bg-gray-200">
            <tr>
              <th className="p-2 border">Product Name</th>
              <th className="p-2 border">Category</th>
              <th className="p-2 border">Size X</th>
              <th className="p-2 border">Size Y</th>
              <th className="p-2 border">Size Z</th>
              <th className="p-2 border">Branch</th>
            </tr>
          </thead>
          <tbody>
            {products.map((product: Product, index: number) => (
              <tr
                key={product._id}
                tabIndex={0}
                onClick={() => openEditor(product)}
                onKeyDown={(e) => handleKeyDown(e, product)}
                onFocus={() => setFocusedRow(index)}
                className={focusedRow === index ? "bg-blue-100" : ""}
              >
                <td className="p-2 border">{product.productName}</td>
                <td className="p-2 border">
                  {typeof product.productType === 'object' ? product.productType?.name : "—"}
                </td>
                <td className="p-2 border">{product.sizeX}</td>
                <td className="p-2 border">{product.sizeY}</td>
                <td className="p-2 border">{product.sizeZ}</td>
                <td className="p-2 border">
                  {typeof product.branchId === 'object' ? product.branchId?.name : "—"}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      ) : (
        <div className="bg-white p-4 shadow-md rounded max-w-lg">
          <h3 className="text-lg font-bold mb-2">Edit Product</h3>

          <label className="block mb-1">Product Name</label>
          <input
            value={editForm.name}
            onChange={(e) => handleEditChange("name", e.target.value)}
            className="border p-2 mb-3 w-full"
          />

          <label className="block mb-1">Category</label>
          <select
            value={editForm.categoryId}
            onChange={(e) => handleEditChange("categoryId", e.target.value)}
            className="border p-2 mb-3 w-full"
          >
            <option value="">Select Category</option>
            {productCategories.map((cat: ProductCategory) => (
              <option key={cat._id} value={cat._id}>
                {cat.name}
              </option>
            ))}
          </select>

          <label className="block mb-1">Size X</label>
          <input
            value={editForm.sizeX}
            onChange={(e) => handleEditChange("sizeX", e.target.value)}
            className="border p-2 mb-3 w-full"
          />

          <label className="block mb-1">Size Y</label>
          <input
            value={editForm.sizeY}
            onChange={(e) => handleEditChange("sizeY", e.target.value)}
            className="border p-2 mb-3 w-full"
          />

          <label className="block mb-1">Size Z</label>
          <input
            value={editForm.sizeZ}
            onChange={(e) => handleEditChange("sizeZ", e.target.value)}
            className="border p-2 mb-3 w-full"
          />

          <div className="flex gap-3 mt-4">
            <button
              onClick={handleUpdate}
              className="bg-green-600 text-white px-4 py-2 rounded"
            >
              Save
            </button>
            <button
              onClick={handleDeleteClick}
              className="bg-red-500 text-white px-4 py-2 rounded"
            >
              Delete
            </button>
            <button
              onClick={() => setSelectedProduct(null)}
              className="bg-gray-400 text-white px-4 py-2 rounded"
            >
              Cancel
            </button>
          </div>
        </div>
      )}

      {showDeleteConfirm && (
        <div className="fixed inset-0 bg-black/40 flex justify-center items-center z-50">
          <div className="bg-white p-6 rounded shadow-lg max-w-sm w-full text-center">
            <h3 className="text-lg font-bold mb-4">
              Type <span className="text-red-600 font-mono">DELETE</span> to confirm
            </h3>
            <input
              type="text"
              value={deleteInput}
              onChange={(e) => setDeleteInput(e.target.value)}
              className="border p-2 w-full mb-4"
              placeholder="Type DELETE to confirm"
            />
            <div className="flex justify-center gap-4">
              <button
                onClick={confirmDelete}
                className="bg-red-600 text-white px-4 py-2 rounded"
              >
                Confirm
              </button>
              <button
                onClick={cancelDelete}
                className="bg-gray-400 text-white px-4 py-2 rounded"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default EditProducts;import React, { useEffect, useRef, useState } from "react";
import { useDispatch, useSelector } from "react-redux";
import {
  getMaterials,
  updateMaterial,
  deleteMaterial,
} from "../../../../redux/create/Materials/MaterialsActions";
import { getMaterialCategories } from "../../../../redux/create/Materials/MaterialsCategories/MaterialsCategoriesActions";
import { RootState } from "../../../../redux/rootReducer";
import { ThunkDispatch } from 'redux-thunk';
import { AnyAction } from 'redux';

interface Material {
  _id: string;
  materialName: string;
  materialMol: number;
  materialType?: {
    _id: string;
    materialTypeName: string;
  };
  branchId?: string;
}

interface MaterialType {
  _id: string;
  materialTypeName: string;
}

const EditMaterials: React.FC = () => {
  const dispatch = useDispatch<ThunkDispatch<RootState, unknown, AnyAction>>();

  const { materials = [], loading, error } = useSelector(
    (state: RootState) => state.materialList || {}
  );
  const { categories: materialCategories = [] } = useSelector(
    (state: RootState) => state.materialCategories || {}
  );
  const { success: updateSuccess } = useSelector(
    (state: RootState) => state.materialUpdate || {}
  );
  const { success: deleteSuccess } = useSelector(
    (state: RootState) => state.materialDelete || {}
  );

  const [focusedRow, setFocusedRow] = useState<number>(-1);
  const [selectedMaterial, setSelectedMaterial] = useState<Material | null>(null);
  const [editForm, setEditForm] = useState({
    materialName: "",
    materialMol: "",
    materialTypeId: "",
  });
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const [deleteInput, setDeleteInput] = useState("");

  const rowRefs = useRef<(HTMLTableRowElement | null)[]>([]);

  useEffect(() => {
    dispatch(getMaterials());
    dispatch(getMaterialCategories());
  }, [dispatch, updateSuccess, deleteSuccess]);

  useEffect(() => {
    if (focusedRow >= 0 && rowRefs.current[focusedRow]) {
      rowRefs.current[focusedRow]?.focus();
    }
  }, [focusedRow]);

  const handleKeyDown = (
    e: React.KeyboardEvent<HTMLTableRowElement>,
    material: Material
  ) => {
    if (e.key === "Enter") openEditor(material);
    else if (e.key === "ArrowDown")
      setFocusedRow((prev) => Math.min(prev + 1, materials.length - 1));
    else if (e.key === "ArrowUp")
      setFocusedRow((prev) => Math.max(prev - 1, 0));
  };

  const openEditor = (material: Material) => {
    setSelectedMaterial(material);
    setEditForm({
      materialName: material.materialName || "",
      materialMol: material.materialMol?.toString() || "",
      materialTypeId: material.materialType?._id || "",
    });
  };

  const handleEditChange = (field: keyof typeof editForm, value: string) => {
    setEditForm({ ...editForm, [field]: value });
  };

  const handleUpdate = () => {
    if (!selectedMaterial) return;

    if (
      !editForm.materialName.trim() ||
      !editForm.materialMol.trim() ||
      !editForm.materialTypeId
    ) {
      alert("❌ All fields are required");
      return;
    }

    dispatch(
      updateMaterial(selectedMaterial._id, {
        materialName: editForm.materialName.trim(),
        materialMol: parseFloat(editForm.materialMol.trim()) || 0,
        materialType: editForm.materialTypeId,
      })
    );
    setSelectedMaterial(null);
  };

  const handleDeleteClick = () => {
    setDeleteInput("");
    setShowDeleteConfirm(true);
  };

  const confirmDelete = () => {
    if (deleteInput === "DELETE" && selectedMaterial) {
      dispatch(deleteMaterial(selectedMaterial._id));
      setShowDeleteConfirm(false);
      setSelectedMaterial(null);
    } else {
      alert("❌ Type DELETE to confirm deletion");
    }
  };

  const cancelDelete = () => setShowDeleteConfirm(false);

  return (
    <div className="EditMaterials p-4">
      <h2 className="text-xl font-semibold mb-4">Material List</h2>

      {loading && <p>Loading...</p>}
      {error && <p className="text-red-500">{error}</p>}

      {!selectedMaterial ? (
        <table className="w-full border border-collapse">
          <thead className="bg-gray-200">
            <tr>
              <th className="p-2 border">Name</th>
              <th className="p-2 border">Mol</th>
              <th className="p-2 border">Category</th>
              <th className="p-2 border">Branch</th>
            </tr>
          </thead>
          <tbody>
            {materials.map((material, index) => (
              <tr
                key={material._id}
                ref={(el) => (rowRefs.current[index] = el)}
                tabIndex={0}
                onClick={() => openEditor(material)}
                onKeyDown={(e) => handleKeyDown(e, material)}
                onFocus={() => setFocusedRow(index)}
                className={focusedRow === index ? "bg-blue-100" : ""}
              >
                <td className="p-2 border">{material.materialName}</td>
                <td className="p-2 border">{material.materialMol}</td>
                <td className="p-2 border">
                  {material.materialType?.materialTypeName || "-"}
                </td>
                <td className="p-2 border">{material.branchId || "-"}</td>
              </tr>
            ))}
          </tbody>
        </table>
      ) : (
        <div className="bg-white p-4 shadow-md rounded max-w-lg">
          <h3 className="text-lg font-bold mb-2">Edit Material</h3>

          <label className="block mb-1">Name</label>
          <input
            value={editForm.materialName}
            onChange={(e) => handleEditChange("materialName", e.target.value)}
            className="border p-2 mb-3 w-full"
          />

          <label className="block mb-1">Mol</label>
          <input
            type="number"
            value={editForm.materialMol}
            onChange={(e) => handleEditChange("materialMol", e.target.value)}
            className="border p-2 mb-3 w-full"
          />

          <label className="block mb-1">Material Category</label>
          <select
            value={editForm.materialTypeId}
            onChange={(e) => handleEditChange("materialTypeId", e.target.value)}
            className="border p-2 mb-3 w-full"
          >
            <option value="">Select Category</option>
            {materialCategories.map((type: MaterialType) => (
              <option key={type._id} value={type._id}>
                {type.materialTypeName}
              </option>
            ))}
          </select>

          <div className="flex gap-3 mt-4">
            <button
              onClick={handleUpdate}
              className="bg-green-600 text-white px-4 py-2 rounded"
            >
              Save Changes
            </button>
            <button
              onClick={handleDeleteClick}
              className="bg-red-500 text-white px-4 py-2 rounded"
            >
              Delete
            </button>
            <button
              onClick={() => setSelectedMaterial(null)}
              className="bg-gray-400 text-white px-4 py-2 rounded"
            >
              Cancel
            </button>
          </div>
        </div>
      )}

      {showDeleteConfirm && (
        <div className="fixed inset-0 bg-black/40 flex justify-center items-center z-50">
          <div className="bg-white p-6 rounded shadow-lg max-w-sm w-full text-center">
            <h3 className="text-lg font-bold mb-4">
              Type <span className="text-red-600 font-mono">DELETE</span> to confirm
            </h3>
            <input
              type="text"
              value={deleteInput}
              onChange={(e) => setDeleteInput(e.target.value)}
              className="border p-2 w-full mb-4"
              placeholder="Type DELETE to confirm"
            />
            <div className="flex justify-center gap-4">
              <button
                onClick={confirmDelete}
                className="bg-red-600 text-white px-4 py-2 rounded"
              >
                Confirm
              </button>
              <button
                onClick={cancelDelete}
                className="bg-gray-400 text-white px-4 py-2 rounded"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default EditMaterials;import React, { useEffect, useState, useCallback } from "react";
import "./EditMaterials.css";
import { useDispatch, useSelector } from "react-redux";
import { getAllMaterialTypesWithMaterials } from "../../../../redux/create/Materials/MaterialsCategories/MaterialsCategoriesActions";
import { RootState } from "../../../../redux/rootReducer";
import { AppDispatch } from "../../../../../store";

interface Material {
  _id: string;
  materialName: string;
  materialMol: number;
  type: string;
}

interface MaterialType {
  _id: string;
  materialTypeName: string;
  description?: string;
  materials: Material[];
  createdAt?: string;
  updatedAt?: string;
  branchId: {
    _id: string;
    name: string;
  };
}

const EditMaterialsCategories: React.FC = () => {
  const dispatch = useDispatch<AppDispatch>();

  const {
    categories: materialTypes = [],
    loading,
    error,
  } = useSelector((state: RootState) => state.materialCategories || {}) as unknown as {
    categories: MaterialType[];
    loading: boolean;
    error: string | null;
  };

  const [selectedRow, setSelectedRow] = useState(0);
  const [showDetail, setShowDetail] = useState(false);
  const [editName, setEditName] = useState("");
  const [editDescription, setEditDescription] = useState("");

  const selectedItem: MaterialType | undefined = materialTypes[selectedRow];
  
  const handleKeyDown = useCallback(
    (e: KeyboardEvent) => {
      if (showDetail || materialTypes.length === 0) return;

      if (e.key === "ArrowDown") {
        setSelectedRow((prev) => Math.min(prev + 1, materialTypes.length - 1));
      } else if (e.key === "ArrowUp") {
        setSelectedRow((prev) => Math.max(prev - 1, 0));
      } else if (e.key === "Enter") {
        const selected = materialTypes[selectedRow];
        if (selected) {
          setEditName(selected.materialTypeName);
          setEditDescription(selected.description || "");
          setShowDetail(true);
        }
      }
    },
    [materialTypes, selectedRow, showDetail]
  );

  useEffect(() => {
    dispatch(getAllMaterialTypesWithMaterials());
  }, [dispatch]);

  useEffect(() => {
    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [handleKeyDown]);

  const handleEditChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setEditName(e.target.value);
  };

  const handleDescriptionChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
    setEditDescription(e.target.value);
  };

  const handleEditSave = () => {
    alert("Material Type updated! (not saved to DB)");
  };

  return (
    <div className="EditMachineType">
       {loading && <p className="loadingAndError">Loading...</p>}
      {error && <p className="loadingAndError"  style={{ color: "red" }}>{error}</p>}

      {!showDetail && !loading && materialTypes.length > 0 ? (
        <table>
          <thead>
            <tr>
              <th>No</th>
              <th>Material Type</th>
              <th>Total Materials</th>
              <th>Branch</th>
              <th>Created</th>
              <th>Updated</th>
              <th>Edit</th>
            </tr>
          </thead>
          <tbody>
            {materialTypes.map((item, index) => (
              <tr
                key={item._id}
                className={selectedRow === index ? "bg-blue-100" : ""}
              >
                <td>{index + 1}</td>
                <td>{item.materialTypeName}</td>
                <td>{item.materials?.length ?? 0}</td>
                <td>{item.branchId?.name || "N/A"}</td>
                <td>{item.createdAt ? new Date(item.createdAt).toLocaleDateString() : "N/A"}</td>
                <td>{item.updatedAt ? new Date(item.updatedAt).toLocaleDateString() : "N/A"}</td>
                <td
                  className="text-blue-600 emt-edit-text"
                  onClick={() => {
                    setSelectedRow(index);
                    setEditName(item.materialTypeName);
                    setEditDescription(item.description || "");
                    setShowDetail(true);
                  }}
                >
                  Edit
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      ) : showDetail && selectedItem ? (
        <div className="detail-container">
          <div className="TopButtonEdit">
            <button onClick={() => setShowDetail(false)}>Back</button>
            <button onClick={handleEditSave} className="Delete">
              Delete
            </button>
          </div>

          <div className="form-section">
            <label>Material Type:</label>
            <input type="text" value={editName} onChange={handleEditChange} />
          </div>

          <div className="form-section">
            <label>Description:</label>
            <textarea
              value={editDescription}
              onChange={handleDescriptionChange}
              rows={3}
            />
          </div>

          <button
            onClick={handleEditSave}
            className="save-button"
            disabled={
              editName === selectedItem.materialTypeName &&
              editDescription === (selectedItem.description || "")
            }
          >
            Save
          </button>

          <div className="info-section">
            <p><strong>Total Materials:</strong> {selectedItem?.materials?.length ?? 0}</p>
            <p><strong>Branch:</strong> {selectedItem.branchId?.name || "N/A"}</p>
            <p><strong>Created At:</strong> {selectedItem.createdAt ? new Date(selectedItem.createdAt).toLocaleString() : "N/A"}</p>
            <p><strong>Updated At:</strong> {selectedItem.updatedAt ? new Date(selectedItem.updatedAt).toLocaleString() : "N/A"}</p>
          </div>

          <table className="machine-details-table">
            <thead>
              <tr>
                <th>No</th>
                <th>Material Name</th>
                <th>Mol</th>
              </tr>
            </thead>
            <tbody>
              {selectedItem?.materials.map((m, idx) => (
                <tr key={idx}>
                  <td>{idx + 1}</td>
                  <td>{m.materialName}</td>
                  <td>{m.materialMol}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      ) : (
        !loading && <p>No material types available.</p>
      )}
    </div>
  );
};

export default EditMaterialsCategories;import React, { useState, useEffect, useRef } from "react";
import EditNewAccount from "./EditNewAccount/EditNewAccount";
import EditMaterials from "./EditMaterials/EditMaterials";
import EditStep from "./EditCreateStep/EditStep";
// import EditProduct from "./EditProducts/EditProduct";
// import EditProductCategoris from "./EditProducts/EditProductCategoris";
import EditDeviceAccess from "./EditDeviceAccess/EditDeviceAccess";
import EditAccess from "./EditDeviceAccess/EditDeviceAccessCreate";
import EditMachine from "./EditMachine/EditMachine";
import MaterialsCategories from "./EditMaterials/MaterialsCategories";
import EditMachineOpertor from "./EditMachineOpertor/EditMachineOPertor";
import EditMachineType from "./EditMachineType/EditMachineyType";
import UpdataIDAndPassword from "./UpdataIDandPassword/UpdataIDAndPassword";
import ErrorBoundary from "../../../error/error";  
import Headers from "../../header/Headers";
import "../create/create.css";
import "../../../main/sidebar/menu.css";
import { useSelector } from "react-redux";

const EditIndex = () => {
  const [activeComponent, setActiveComponent] = useState("account");
  const [title, setTitle] = useState("Account");
  const buttonRefs = useRef<(HTMLLIElement | null)[]>([]);
  const [selectedIndex, setSelectedIndex] = useState(0);
    
  
 const userRole = useSelector((state: any) => state.auth.userData?.role);
 console.log(userRole , "this Role Me");
 
  const baseComponentsMap: Record<string, JSX.Element> = {
    account: <ErrorBoundary> <EditNewAccount /> </ErrorBoundary>,
    machineType: <ErrorBoundary> <EditMachineType /> </ErrorBoundary>,
    machine: <ErrorBoundary> <EditMachine /> </ErrorBoundary>,
    step: <ErrorBoundary> <EditStep /> </ErrorBoundary>,
    machineOperator: <ErrorBoundary> <EditMachineOpertor /> </ErrorBoundary>,
    DeviceAccess: <ErrorBoundary> <EditDeviceAccess /></ErrorBoundary>,
    Access: <ErrorBoundary> <EditAccess /></ErrorBoundary>,
    // products: <EditProduct />,
    // categories: <EditProductCategoris />,

    materials: <ErrorBoundary> <EditMaterials /> </ErrorBoundary>,
    materialsCategories: <ErrorBoundary> <MaterialsCategories /></ErrorBoundary> ,
  };

  const baseTitlesMap: Record<string, string> = {
    account: "Account",
    machineType: "Machine Type",
    machine: "Machine",
    step: "Step",
    machineOperator: "Machine Operator",
    DeviceAccess: "Device Access",
    Access: "Access",
    // products: "Products",
    // categories: "Product Categories",
    materials: "Materials",
    materialsCategories: "Materials Categories"
  };

  if (userRole === "manager") {
    baseComponentsMap["updatePassword"] = <UpdataIDAndPassword />;
    baseTitlesMap["updatePassword"] = "Update ID & Password";
  }

  const componentsMap = baseComponentsMap;
  const titlesMap = baseTitlesMap;

  useEffect(() => {
    setTitle(titlesMap[activeComponent] || "Select an Option");
  }, [activeComponent]);

  useEffect(() => {
    buttonRefs.current[selectedIndex]?.focus();
  }, [selectedIndex]);

  const menuItems = Object.entries(titlesMap);

  const handleKeyDown = (e: React.KeyboardEvent<HTMLLIElement>, index: number) => {
    const total = menuItems.length;
    if (e.key === "ArrowDown") {
      e.preventDefault();
      setSelectedIndex((index + 1) % total);
    } else if (e.key === "ArrowUp") {
      e.preventDefault();
      setSelectedIndex((index - 1 + total) % total);
    } else if (e.key === "Enter") {
      e.preventDefault();
      const key = menuItems[index][0];
      setActiveComponent(key);
    }
  };

  return (
    <div className="container" style={{ marginTop: 0 }}>
      {/* Header */}
      <div className="item menu-header" style={{ gridColumn: "1 / -1" }}>
        <Headers title={title} />
      </div>

      {/* Sidebar */}
      <div className="item">
        <div className="menu-container-create">
          <div className="menu-header-padding">
            <ul id="main-menu" style={{ listStyle: "none", padding: 0 }}>
              {menuItems.map(([key, label], index) => (
                <div
                  key={key}
                  className={`menu-item-wrapper ${selectedIndex === index ? "selected" : ""} ${
                    index === 0 || index === 4 || index === 6 ? "bottom-borders-menu" : ""
                  }`}
                >
                  <li
                    ref={(el) => (buttonRefs.current[index] = el)}
                    tabIndex={0}
                    onClick={() => {
                      setActiveComponent(key);
                      setSelectedIndex(index);
                    }}
                    onKeyDown={(e) => handleKeyDown(e, index)}
                    style={{
                      outline: "none",
                      borderRadius: "24px",
                      cursor: "pointer",
                      fontWeight: 900,
                      textAlign: "center"
                    }}
                  >
                    {label}
                  </li>
                </div>
              ))}
            </ul>
          </div>
        </div>
      </div>

      {/* Main Content */}
      <div className="item menu-content">
        {componentsMap[activeComponent]}
      </div>

      {/* Footer */}
      <div className="item menu-footer" style={{ gridColumn: "1 / -1" }}>
        © 2025 27infinity. All rights reserved.
      </div>
    </div>
  );
};

export default EditIndex;import React, { useEffect, useState } from "react";
import { useDispatch, useSelector } from "react-redux";
import {
  getMachines,
  updateMachine,
  deleteMachine,
} from "../../../../redux/create/machine/MachineActions";
import { getMachineTypes } from "../../../../redux/create/machineType/machineTypeActions";
import { RootState } from "../../../../redux/rootReducer";
import { AppDispatch } from "../../../../../store";
import { Edit, Trash2, Save, X, Search, Filter } from 'lucide-react';
import "./editMachines.css";

// Define interfaces for type safety
interface MachineType {
  _id: string;
  type: string;
  description?: string;
}

interface Machine {
  _id: string;
  machineName: string;
  sizeX: string;
  sizeY: string;
  sizeZ: string;
  machineType: {
    _id: string;
    type: string;
    description?: string;
  };
  branchId: {
    _id: string;
    name: string;
  };
  tableConfig?: {
    columns: any[];
    formulas: any;
    settings: any;
  };
}

interface EditForm {
  machineName: string;
  sizeX: string;
  sizeY: string;
  sizeZ: string;
  machineTypeId: string;
}

const EditMachines: React.FC = () => {
  const dispatch = useDispatch<AppDispatch>();
  const machineListState = useSelector((state: RootState) => state.machineList) as any;
  const { machines = [], loading, error } = machineListState;
  
  const machineTypeListState = useSelector((state: RootState) => state.machineTypeList) as any;
  const { items: machineTypes = [] } = machineTypeListState;
  
  const machineUpdateState = useSelector((state: RootState) => state.machineUpdate) as any;
  const { success: updateSuccess } = machineUpdateState;
  
  const machineDeleteState = useSelector((state: RootState) => state.machineDelete) as any;
  const { success: deleteSuccess } = machineDeleteState;

  const [focusedRow, setFocusedRow] = useState<number>(-1);
  const [selectedMachine, setSelectedMachine] = useState<Machine | null>(null);
  const [editForm, setEditForm] = useState<EditForm>({
    machineName: "",
    sizeX: "",
    sizeY: "",
    sizeZ: "",
    machineTypeId: "",
  });

  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const [deleteInput, setDeleteInput] = useState("");
  const [searchTerm, setSearchTerm] = useState("");
  const [filterType, setFilterType] = useState("");
  const [successMessage, setSuccessMessage] = useState("");

  useEffect(() => {
    dispatch(getMachines());
    dispatch(getMachineTypes());
  }, [dispatch]);

  useEffect(() => {
    if (updateSuccess) {
      setSuccessMessage("✅ Machine updated successfully!");
      setTimeout(() => setSuccessMessage(""), 3000);
      dispatch(getMachines());
    }
  }, [updateSuccess, dispatch]);

  useEffect(() => {
    if (deleteSuccess) {
      setSuccessMessage("✅ Machine deleted successfully!");
      setTimeout(() => setSuccessMessage(""), 3000);
      dispatch(getMachines());
    }
  }, [deleteSuccess, dispatch]);

  const filteredMachines = machines.filter((machine: Machine) => {
    const matchesSearch = machine.machineName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         machine.machineType?.type.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         machine.branchId?.name.toLowerCase().includes(searchTerm.toLowerCase());
    
    const matchesFilter = !filterType || machine.machineType?._id === filterType;
    
    return matchesSearch && matchesFilter;
  });

  const handleKeyDown = (
    e: React.KeyboardEvent<HTMLTableRowElement>,
    machine: Machine
  ) => {
    if (e.key === "Enter") openEditor(machine);
    else if (e.key === "ArrowDown")
      setFocusedRow((prev) => Math.min(prev + 1, filteredMachines.length - 1));
    else if (e.key === "ArrowUp")
      setFocusedRow((prev) => Math.max(prev - 1, 0));
  };

  const openEditor = (machine: Machine) => {
    setSelectedMachine(machine);
    setEditForm({
      machineName: machine.machineName,
      sizeX: machine.sizeX,
      sizeY: machine.sizeY,
      sizeZ: machine.sizeZ,
      machineTypeId: machine.machineType?._id || "",
    });
  };

  const handleEditChange = (field: keyof EditForm, value: string) => {
    setEditForm({ ...editForm, [field]: value });
  };

  const handleUpdate = () => {
    if (!selectedMachine) return;

    if (!editForm.machineName.trim()) {
      alert("Please enter machine name");
      return;
    }

    if (!editForm.machineTypeId) {
      alert("Please select machine type");
      return;
    }

    if (!editForm.sizeX || !editForm.sizeY || !editForm.sizeZ) {
      alert("Please enter all size dimensions");
      return;
    }

    dispatch(
      updateMachine(selectedMachine._id, {
        machineName: editForm.machineName.trim(),
        sizeX: editForm.sizeX,
        sizeY: editForm.sizeY,
        sizeZ: editForm.sizeZ,
        machineType: editForm.machineTypeId,
      })
    );
    setSelectedMachine(null);
  };

  const handleDeleteClick = () => {
    setDeleteInput("");
    setShowDeleteConfirm(true);
  };

  const confirmDelete = () => {
    if (deleteInput === "DELETE" && selectedMachine) {
      dispatch(deleteMachine(selectedMachine._id));
      setShowDeleteConfirm(false);
      setSelectedMachine(null);
    } else {
      alert("❌ Type DELETE to confirm deletion");
    }
  };

  const cancelDelete = () => setShowDeleteConfirm(false);

  const clearFilters = () => {
    setSearchTerm("");
    setFilterType("");
  };

  return (
    <div className="EditMachinesCss">
      <div className="EditMachinesContainer">
        <div className="EditMachinesHeader">
          <h2 className="EditMachinesTitle">Machine Management</h2>
          {successMessage && (
            <div className="EditMachinesSuccessMessage">{successMessage}</div>
          )}
        </div>

        {loading && <div className="EditMachinesLoading">Loading machines...</div>}
        {error && <div className="EditMachinesError">Error: {error}</div>}

        {!selectedMachine ? (
          <div className="EditMachinesTableSection">
            {/* Search and Filter Controls */}
            <div className="EditMachinesControls">
              <div className="EditMachinesSearchGroup">
                <Search size={20} />
                <input
                  type="text"
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  placeholder="Search machines..."
                  className="EditMachinesSearchInput"
                />
              </div>
              <div className="EditMachinesFilterGroup">
                <Filter size={20} />
                <select
                  value={filterType}
                  onChange={(e) => setFilterType(e.target.value)}
                  className="EditMachinesFilterSelect"
                >
                  <option value="">All Types</option>
                  {machineTypes.map((type: MachineType) => (
                    <option key={type._id} value={type._id}>
                      {type.type}
                    </option>
                  ))}
                </select>
              </div>
              {(searchTerm || filterType) && (
                <button onClick={clearFilters} className="EditMachinesClearFiltersBtn">
                  Clear Filters
                </button>
              )}
            </div>

            {/* Results Summary */}
            <div className="EditMachinesResultsSummary">
              Showing {filteredMachines.length} of {machines.length} machines
            </div>

            {/* Machines Table */}
            <div className="EditMachinesTableWrapper">
              <table className="EditMachinesTable">
                <thead className="EditMachinesTableHeader">
                  <tr>
                    <th className="EditMachinesTableHeaderCell">Machine Name</th>
                    <th className="EditMachinesTableHeaderCell">Type</th>
                    <th className="EditMachinesTableHeaderCell">Size X</th>
                    <th className="EditMachinesTableHeaderCell">Size Y</th>
                    <th className="EditMachinesTableHeaderCell">Size Z</th>
                    <th className="EditMachinesTableHeaderCell">Branch</th>
                    <th className="EditMachinesTableHeaderCell">Table Config</th>
                    <th className="EditMachinesTableHeaderCell">Actions</th>
                  </tr>
                </thead>
                <tbody className="EditMachinesTableBody">
                  {filteredMachines.length === 0 ? (
                    <tr>
                      <td colSpan={8} className="EditMachinesEmptyRow">
                        {searchTerm || filterType ? "No machines match your filters" : "No machines found"}
                      </td>
                    </tr>
                  ) : (
                    filteredMachines.map((machine: Machine, index: number) => (
                      <tr
                        key={machine._id}
                        tabIndex={0}
                        onKeyDown={(e) => handleKeyDown(e, machine)}
                        onFocus={() => setFocusedRow(index)}
                        className={`EditMachinesTableRow ${
                          focusedRow === index ? "EditMachinesTableRowFocused" : ""
                        }`}
                      >
                        <td className="EditMachinesTableCell EditMachinesMachineNameCell">
                          <div className="EditMachinesMachineNameContent">
                            {machine.machineName}
                          </div>
                        </td>
                        <td className="EditMachinesTableCell">
                          <span className="EditMachinesMachineTypeTag">
                            {machine.machineType?.type || "N/A"}
                          </span>
                        </td>
                        <td className="EditMachinesTableCell EditMachinesSizeCell">
                          {machine.sizeX}
                        </td>
                        <td className="EditMachinesTableCell EditMachinesSizeCell">
                          {machine.sizeY}
                        </td>
                        <td className="EditMachinesTableCell EditMachinesSizeCell">
                          {machine.sizeZ}
                        </td>
                        <td className="EditMachinesTableCell">
                          {machine.branchId?.name || "N/A"}
                        </td>
                        <td className="EditMachinesTableCell">
                          <div className="EditMachinesTableConfigIndicator">
                            {machine.tableConfig ? (
                              <span className="EditMachinesTableConfigYes">
                                ✅ {machine.tableConfig.columns?.length || 0} columns
                              </span>
                            ) : (
                              <span className="EditMachinesTableConfigNo">❌ Not configured</span>
                            )}
                          </div>
                        </td>
                        <td className="EditMachinesTableCell">
                          <div className="EditMachinesTableActions">
                            <button
                              onClick={() => openEditor(machine)}
                              className="EditMachinesEditBtn"
                              title="Edit machine"
                            >
                              <Edit size={16} />
                            </button>
                          </div>
                        </td>
                      </tr>
                    ))
                  )}
                </tbody>
              </table>
            </div>
          </div>
        ) : (
          <div className="EditMachinesEditForm">
            <div className="EditMachinesEditHeader">
              <h3 className="EditMachinesEditTitle">Edit Machine</h3>
              <button
                onClick={() => setSelectedMachine(null)}
                className="EditMachinesCloseBtn"
                title="Close editor"
              >
                <X size={20} />
              </button>
            </div>

            <div className="EditMachinesFormGrid">
              <div className="EditMachinesFormGroup">
                <label className="EditMachinesFormLabel">Machine Name *</label>
                <input
                  type="text"
                  value={editForm.machineName}
                  onChange={(e) => handleEditChange("machineName", e.target.value)}
                  className="EditMachinesFormInput"
                  placeholder="Enter machine name"
                />
              </div>

              <div className="EditMachinesFormGroup">
                <label className="EditMachinesFormLabel">Machine Type *</label>
                <select
                  value={editForm.machineTypeId}
                  onChange={(e) => handleEditChange("machineTypeId", e.target.value)}
                  className="EditMachinesFormSelect"
                >
                  <option value="">Select Type</option>
                  {machineTypes.map((type: MachineType) => (
                    <option key={type._id} value={type._id}>
                      {type.type}
                    </option>
                  ))}
                </select>
              </div>

              <div className="EditMachinesFormGroup">
                <label className="EditMachinesFormLabel">Size X *</label>
                <input
                  type="number"
                  min="0"
                  step="0.1"
                  value={editForm.sizeX}
                  onChange={(e) => handleEditChange("sizeX", e.target.value)}
                  className="EditMachinesFormInput"
                  placeholder="Enter X dimension"
                />
              </div>

              <div className="EditMachinesFormGroup">
                <label className="EditMachinesFormLabel">Size Y *</label>
                <input
                  type="number"
                  min="0"
                  step="0.1"
                  value={editForm.sizeY}
                  onChange={(e) => handleEditChange("sizeY", e.target.value)}
                  className="EditMachinesFormInput"
                  placeholder="Enter Y dimension"
                />
              </div>

              <div className="EditMachinesFormGroup">
                <label className="EditMachinesFormLabel">Size Z *</label>
                <input
                  type="number"
                  min="0"
                  step="0.1"
                  value={editForm.sizeZ}
                  onChange={(e) => handleEditChange("sizeZ", e.target.value)}
                  className="EditMachinesFormInput"
                  placeholder="Enter Z dimension"
                />
              </div>
            </div>

            {/* Current Machine Info */}
            <div className="EditMachinesCurrentInfo">
              <h4 className="EditMachinesCurrentInfoTitle">Current Machine Information</h4>
              <div className="EditMachinesCurrentInfoGrid">
                <div className="EditMachinesInfoItem">
                  <span className="EditMachinesInfoLabel">Branch:</span>
                  <span className="EditMachinesInfoValue">{selectedMachine.branchId?.name || "N/A"}</span>
                </div>
                <div className="EditMachinesInfoItem">
                  <span className="EditMachinesInfoLabel">Table Configuration:</span>
                  <span className="EditMachinesInfoValue">
                    {selectedMachine.tableConfig ? (
                      <span className="EditMachinesTableConfigYes">
                        ✅ {selectedMachine.tableConfig.columns?.length || 0} columns configured
                      </span>
                    ) : (
                      <span className="EditMachinesTableConfigNo">❌ No table configuration</span>
                    )}
                  </span>
                </div>
              </div>
            </div>

            <div className="EditMachinesFormActions">
              <button
                onClick={handleUpdate}
                className="EditMachinesSaveBtn"
                disabled={!editForm.machineName.trim() || !editForm.machineTypeId}
              >
                <Save size={16} />
                Save Changes
              </button>
              <button
                onClick={handleDeleteClick}
                className="EditMachinesDeleteBtn"
              >
                <Trash2 size={16} />
                Delete Machine
              </button>
              <button
                onClick={() => setSelectedMachine(null)}
                className="EditMachinesCancelBtn"
              >
                Cancel
              </button>
            </div>
          </div>
        )}

        {/* Delete Confirmation Modal */}
        {showDeleteConfirm && (
          <div className="EditMachinesModal">
            <div className="EditMachinesModalContent">
              <h3 className="EditMachinesModalTitle">
                Confirm Machine Deletion
              </h3>
              <div className="EditMachinesModalBody">
                <p className="EditMachinesModalText">
                  You are about to delete the machine: <strong>{selectedMachine?.machineName}</strong>
                </p>
                <p className="EditMachinesModalWarning">
                  This action cannot be undone. Type{" "}
                  <span className="EditMachinesDeleteKeyword">DELETE</span> to confirm.
                </p>
                <input
                  type="text"
                  value={deleteInput}
                  onChange={(e) => setDeleteInput(e.target.value)}
                  className="EditMachinesModalInput"
                  placeholder="Type DELETE to confirm"
                  autoFocus
                />
              </div>
              <div className="EditMachinesModalActions">
                <button
                  onClick={confirmDelete}
                  className="EditMachinesModalConfirmBtn"
                  disabled={deleteInput !== "DELETE"}
                >
                  Confirm Delete
                </button>
                <button
                  onClick={cancelDelete}
                  className="EditMachinesModalCancelBtn"
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default EditMachines;/* Main Container */
.EditMachinesCss {
  display: flex;
  flex-direction: column;
  width: 100%;
  min-height: 100vh;
  background-color: #f8f9fc;
  padding: 20px;
  box-sizing: border-box;
}

.EditMachinesContainer {
  max-width: 1400px;
  width: 100%;
  margin: 0 auto;
  background-color: #ffffff;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  overflow: hidden;
}

/* Header Section */
.EditMachinesHeader {
  padding: 25px 30px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  position: relative;
}

.EditMachinesTitle {
  font-size: 28px;
  font-weight: 700;
  margin: 0;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.EditMachinesSuccessMessage {
  position: absolute;
  top: 15px;
  right: 20px;
  background-color: rgba(255, 255, 255, 0.95);
  color: #27ae60;
  padding: 10px 16px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 14px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  animation: slideInRight 0.5s ease-out;
}

@keyframes slideInRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* Loading and Error States */
.EditMachinesLoading {
  text-align: center;
  padding: 40px;
  color: #7f8c8d;
  font-size: 16px;
  font-weight: 500;
}

.EditMachinesError {
  background-color: #fee;
  color: #e74c3c;
  padding: 15px 20px;
  margin: 20px;
  border-radius: 8px;
  border: 1px solid #fcc;
  font-weight: 500;
}

/* Table Section */
.EditMachinesTableSection {
  padding: 30px;
}

/* Controls */
.EditMachinesControls {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  margin-bottom: 25px;
  align-items: center;
}

.EditMachinesSearchGroup {
  display: flex;
  align-items: center;
  gap: 10px;
  background-color: #f8f9fc;
  padding: 12px 16px;
  border-radius: 8px;
  border: 2px solid #e3e8f0;
  flex: 1;
  min-width: 250px;
  transition: all 0.3s ease;
}

.EditMachinesSearchGroup:focus-within {
  border-color: #3498db;
  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
}

.EditMachinesSearchGroup svg {
  color: #7f8c8d;
}

.EditMachinesSearchInput {
  border: none;
  background: transparent;
  outline: none;
  font-size: 14px;
  flex: 1;
  color: #2c3e50;
}

.EditMachinesSearchInput::placeholder {
  color: #95a5a6;
}

.EditMachinesFilterGroup {
  display: flex;
  align-items: center;
  gap: 10px;
  background-color: #f8f9fc;
  padding: 12px 16px;
  border-radius: 8px;
  border: 2px solid #e3e8f0;
  min-width: 200px;
  transition: all 0.3s ease;
}

.EditMachinesFilterGroup:focus-within {
  border-color: #f39c12;
  box-shadow: 0 0 0 3px rgba(243, 156, 18, 0.1);
}

.EditMachinesFilterGroup svg {
  color: #7f8c8d;
}

.EditMachinesFilterSelect {
  border: none;
  background: transparent;
  outline: none;
  font-size: 14px;
  color: #2c3e50;
  cursor: pointer;
  flex: 1;
}

.EditMachinesClearFiltersBtn {
  background-color: #e74c3c;
  color: white;
  border: none;
  padding: 12px 16px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
}

.EditMachinesClearFiltersBtn:hover {
  background-color: #c0392b;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
}

.EditMachinesResultsSummary {
  color: #7f8c8d;
  font-size: 14px;
  margin-bottom: 20px;
  padding: 10px 0;
  border-bottom: 1px solid #ecf0f1;
}

/* Table */
.EditMachinesTableWrapper {
  overflow-x: auto;
  border-radius: 10px;
  box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
  border: 1px solid #e3e8f0;
}

.EditMachinesTable {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
  background-color: #ffffff;
}

.EditMachinesTableHeader {
  background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
  color: white;
}

.EditMachinesTableHeaderCell {
  padding: 18px 15px;
  text-align: left;
  font-weight: 600;
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 2px solid #2c3e50;
  white-space: nowrap;
}

.EditMachinesTableBody {
  background-color: #ffffff;
}

.EditMachinesTableRow {
  border-bottom: 1px solid #ecf0f1;
  transition: all 0.3s ease;
  cursor: pointer;
}

.EditMachinesTableRow:hover {
  background-color: #f8f9fc;
  transform: translateY(-1px);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.EditMachinesTableRowFocused {
  background-color: #e3f2fd !important;
  border-left: 4px solid #2196f3;
  box-shadow: inset 0 0 0 1px rgba(33, 150, 243, 0.3);
}

.EditMachinesTableCell {
  padding: 15px;
  vertical-align: middle;
  color: #2c3e50;
  border-bottom: 1px solid #ecf0f1;
}

.EditMachinesMachineNameCell {
  font-weight: 600;
  min-width: 180px;
}

.EditMachinesMachineNameContent {
  display: flex;
  align-items: center;
  gap: 8px;
}

.EditMachinesMachineTypeTag {
  background-color: #3498db;
  color: white;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.EditMachinesSizeCell {
  text-align: center;
  font-family: 'Monaco', 'Menlo', monospace;
  font-weight: 500;
  color: #34495e;
}

.EditMachinesTableConfigIndicator {
  display: flex;
  align-items: center;
  justify-content: center;
}

.EditMachinesTableConfigYes {
  color: #27ae60;
  font-weight: 500;
  font-size: 12px;
}

.EditMachinesTableConfigNo {
  color: #e74c3c;
  font-weight: 500;
  font-size: 12px;
}

.EditMachinesTableActions {
  display: flex;
  justify-content: center;
  gap: 8px;
}

.EditMachinesEditBtn {
  background-color: #f39c12;
  color: white;
  border: none;
  padding: 8px;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.EditMachinesEditBtn:hover {
  background-color: #e67e22;
  transform: scale(1.1);
  box-shadow: 0 3px 10px rgba(243, 156, 18, 0.3);
}

.EditMachinesEmptyRow {
  text-align: center;
  padding: 40px;
  color: #7f8c8d;
  font-style: italic;
  background-color: #f8f9fc;
}

/* Edit Form */
.EditMachinesEditForm {
  padding: 30px;
  background-color: #ffffff;
}

.EditMachinesEditHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  padding-bottom: 15px;
  border-bottom: 2px solid #ecf0f1;
}

.EditMachinesEditTitle {
  font-size: 24px;
  font-weight: 600;
  color: #2c3e50;
  margin: 0;
}

.EditMachinesCloseBtn {
  background-color: #95a5a6;
  color: white;
  border: none;
  padding: 8px;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.EditMachinesCloseBtn:hover {
  background-color: #7f8c8d;
  transform: scale(1.1);
}

.EditMachinesFormGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.EditMachinesFormGroup {
  display: flex;
  flex-direction: column;
}

.EditMachinesFormLabel {
  font-weight: 600;
  color: #34495e;
  margin-bottom: 8px;
  font-size: 14px;
  letter-spacing: 0.3px;
}

.EditMachinesFormInput,
.EditMachinesFormSelect {
  padding: 12px 16px;
  border: 2px solid #e0e6ed;
  border-radius: 8px;
  font-size: 14px;
  color: #2c3e50;
  background-color: #ffffff;
  transition: all 0.3s ease;
  outline: none;
}

.EditMachinesFormInput:focus,
.EditMachinesFormSelect:focus {
  border-color: #3498db;
  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
}

.EditMachinesFormSelect {
  cursor: pointer;
}

/* Current Machine Info */
.EditMachinesCurrentInfo {
  background-color: #f8f9fc;
  padding: 20px;
  border-radius: 10px;
  border: 1px solid #e3e8f0;
  margin-bottom: 25px;
}

.EditMachinesCurrentInfoTitle {
  font-size: 16px;
  font-weight: 600;
  color: #2c3e50;
  margin: 0 0 15px 0;
}

.EditMachinesCurrentInfoGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
}

.EditMachinesInfoItem {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid #ecf0f1;
}

.EditMachinesInfoItem:last-child {
  border-bottom: none;
}

.EditMachinesInfoLabel {
  font-weight: 500;
  color: #7f8c8d;
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.EditMachinesInfoValue {
  font-weight: 600;
  color: #34495e;
  font-size: 14px;
}

/* Form Actions */
.EditMachinesFormActions {
  display: flex;
  gap: 15px;
  justify-content: flex-end;
  align-items: center;
  flex-wrap: wrap;
  padding-top: 20px;
  border-top: 2px solid #ecf0f1;
}

.EditMachinesSaveBtn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  background: linear-gradient(135deg, #27ae60, #229954);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.EditMachinesSaveBtn:hover:not(:disabled) {
  background: linear-gradient(135deg, #229954, #1e8449);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(39, 174, 96, 0.3);
}

.EditMachinesSaveBtn:disabled {
  background: linear-gradient(135deg, #bdc3c7, #95a5a6);
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.EditMachinesDeleteBtn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  background: linear-gradient(135deg, #e74c3c, #c0392b);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.EditMachinesDeleteBtn:hover {
  background: linear-gradient(135deg, #c0392b, #a93226);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3);
}

.EditMachinesCancelBtn {
  padding: 12px 20px;
  background-color: #95a5a6;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.EditMachinesCancelBtn:hover {
  background-color: #7f8c8d;
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(149, 165, 166, 0.3);
}

/* Modal Styles */
.EditMachinesModal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  backdrop-filter: blur(5px);
}

.EditMachinesModalContent {
  background-color: #ffffff;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
  max-width: 500px;
  width: 90%;
  text-align: center;
  animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
  from {
    transform: translateY(-50px) scale(0.95);
    opacity: 0;
  }
  to {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
}

.EditMachinesModalTitle {
  font-size: 20px;
  font-weight: 700;
  color: #2c3e50;
  margin: 0 0 20px 0;
}

.EditMachinesModalBody {
  margin-bottom: 25px;
}

.EditMachinesModalText {
  color: #34495e;
  margin-bottom: 15px;
  font-size: 14px;
  line-height: 1.5;
}

.EditMachinesModalWarning {
  color: #e74c3c;
  font-weight: 600;
  margin-bottom: 20px;
  font-size: 14px;
  background-color: #fdf2f2;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #fcc;
}

.EditMachinesDeleteKeyword {
  font-family: 'Monaco', 'Menlo', monospace;
  background-color: #2c3e50;
  color: white;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: bold;
}

.EditMachinesModalInput {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #e0e6ed;
  border-radius: 8px;
  font-size: 14px;
  color: #2c3e50;
  background-color: #ffffff;
  text-align: center;
  font-family: 'Monaco', 'Menlo', monospace;
  font-weight: bold;
  outline: none;
  transition: all 0.3s ease;
  box-sizing: border-box;
}

.EditMachinesModalInput:focus {
  border-color: #e74c3c;
  box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
}

.EditMachinesModalActions {
  display: flex;
  justify-content: center;
  gap: 15px;
}

.EditMachinesModalConfirmBtn {
  padding: 12px 20px;
  background: linear-gradient(135deg, #e74c3c, #c0392b);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.EditMachinesModalConfirmBtn:hover:not(:disabled) {
  background: linear-gradient(135deg, #c0392b, #a93226);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3);
}

.EditMachinesModalConfirmBtn:disabled {
  background: linear-gradient(135deg, #bdc3c7, #95a5a6);
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.EditMachinesModalCancelBtn {
  padding: 12px 20px;
  background-color: #95a5a6;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.EditMachinesModalCancelBtn:hover {
  background-color: #7f8c8d;
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(149, 165, 166, 0.3);
}

/* Responsive Design */
@media (max-width: 1200px) {
  .EditMachinesFormGrid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  }
  
  .EditMachinesCurrentInfoGrid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .EditMachinesCss {
    padding: 10px;
  }
  
  .EditMachinesHeader {
    padding: 20px;
  }
  
  .EditMachinesTitle {
    font-size: 24px;
  }
  
  .EditMachinesTableSection,
  .EditMachinesEditForm {
    padding: 20px;
  }
  
  .EditMachinesControls {
    flex-direction: column;
    align-items: stretch;
  }
  
  .EditMachinesSearchGroup,
  .EditMachinesFilterGroup {
    min-width: auto;
  }
  
  .EditMachinesTableWrapper {
    font-size: 12px;
  }
  
  .EditMachinesTableHeaderCell,
  .EditMachinesTableCell {
    padding: 10px 8px;
  }
  
  .EditMachinesFormGrid {
    grid-template-columns: 1fr;
  }
  
  .EditMachinesFormActions {
    flex-direction: column;
    align-items: stretch;
  }
  
  .EditMachinesSaveBtn,
  .EditMachinesDeleteBtn,
  .EditMachinesCancelBtn {
    justify-content: center;
  }
  
  .EditMachinesSuccessMessage {
    position: static;
    margin-top: 15px;
  }
}

@media (max-width: 480px) {
  .EditMachinesHeader {
    padding: 15px;
  }
  
  .EditMachinesTitle {
    font-size: 20px;
  }
  
  .EditMachinesTableSection,
  .EditMachinesEditForm {
    padding: 15px;
  }
  
  .EditMachinesModalContent {
    padding: 20px;
    margin: 20px;
  }
  
  .EditMachinesModalActions {
    flex-direction: column;
  }
  
  .EditMachinesModalConfirmBtn,
  .EditMachinesModalCancelBtn {
    width: 100%;
  }
}

/* Table Responsive Styles */
@media (max-width: 1024px) {
  .EditMachinesTable {
    font-size: 12px;
  }
  
  .EditMachinesTableHeaderCell {
    padding: 12px 8px;
    font-size: 11px;
  }
  
  .EditMachinesTableCell {
    padding: 10px 8px;
  }
  
  .EditMachinesMachineTypeTag {
    font-size: 10px;
    padding: 2px 8px;
  }
}

/* Focus and Accessibility */
.EditMachinesTable:focus {
  outline: 2px solid #3498db;
  outline-offset: 2px;
}

.EditMachinesTableRow:focus {
  outline: 2px solid #3498db;
  outline-offset: -2px;
}

/* Print Styles */
@media print {
  .EditMachinesControls,
  .EditMachinesFormActions,
  .EditMachinesTableActions {
    display: none;
  }
  
  .EditMachinesContainer {
    box-shadow: none;
    border: 1px solid #ddd;
  }
  
  .EditMachinesHeader {
    background: #f5f5f5 !important;
    color: #333 !important;
  }
}import React, { useEffect, useState, useCallback } from "react";
import { useDispatch, useSelector } from "react-redux";
import {
  getDeviceAccessList,
  updateDeviceAccess,
} from "../../../../redux/deviceAccess/deviceAccessActions";
import { RootState } from "../../../../redux/rootReducer";
import { AppDispatch } from "../../../../../store";


interface DeviceAccessCreate {
  _id: string;
  deviceName?: string;
  location?: string;
  password?: string;
  pin?: string;
  createdAt?: string;
  updatedAt?: string;
}

const EditDeviceAccessCreate: React.FC = () => {
  const dispatch = useDispatch<AppDispatch>();

  const { devices = [], loading, error } = useSelector(
    (state: RootState) => state.deviceAccess || {}
  );

  const [selectedRow, setSelectedRow] = useState(0);
  const [showDetail, setShowDetail] = useState(false);
  const [form, setForm] = useState<Partial<DeviceAccessCreate>>({});
  const [showPassword, setShowPassword] = useState(false);
  const [confirmPassword, setConfirmPassword] = useState("");
  const [confirmPin, setConfirmPin] = useState("");

  const handleKeyDown = useCallback(
    (e: KeyboardEvent) => {
      if (showDetail || devices.length === 0) return;

      if (e.key === "ArrowDown") {
        setSelectedRow((prev) => Math.min(prev + 1, devices.length - 1));
      } else if (e.key === "ArrowUp") {
        setSelectedRow((prev) => Math.max(prev - 1, 0));
      } else if (e.key === "Enter") {
        const selected = devices[selectedRow];
        if (selected) {
          setForm(selected);
          setShowDetail(true);
        }
      }
    },
    [devices, selectedRow, showDetail]
  );

  useEffect(() => {
    dispatch(getDeviceAccessList());
  }, [dispatch]);

  useEffect(() => {
    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [handleKeyDown]);

  const handleFormChange = (key: keyof DeviceAccessCreate, value: string) => {
    setForm((prev) => ({ ...prev, [key]: value }));
  };

  const handleSave = async () => {
    if (!form._id) return;

    if (!form.deviceName?.trim()) {
      alert("Device name is required");
      return;
    }

    if (form.password && form.password !== confirmPassword) {
      alert("Passwords do not match");
      return;
    }

    if (form.pin && form.pin !== confirmPin) {
      alert("PINs do not match");
      return;
    }

    try {
      await dispatch(updateDeviceAccess(form._id, "updateDevice", form));
      alert("Device access updated successfully!");
      setShowDetail(false);
      setConfirmPassword("");
      setConfirmPin("");
      dispatch(getDeviceAccessList());
    } catch (err) {
      alert("Failed to update device access.");
    }
  };

  const handleRowClick = (index: number, item: DeviceAccessCreate) => {
    setSelectedRow(index);
    setForm(item);
    setShowDetail(true);
    setConfirmPassword("");
    setConfirmPin("");
  };

  const inputType = (field: string) =>
    showPassword && (field.includes("password") || field.includes("pin"))
      ? "text"
      : field.includes("password") || field.includes("pin")
      ? "password"
      : "text";

  const toggleBtnStyle: React.CSSProperties = {
    position: "absolute",
    right: "10px",
    top: "50%",
    transform: "translateY(-50%)",
    background: "none",
    border: "none",
    cursor: "pointer",
    fontSize: "1rem",
  };

  return (
    <div className="EditAccount EditMachineType">
       {loading && <p className="loadingAndError">Loading...</p>}
      {error && <p className="loadingAndError"  style={{ color: "red" }}>{error}</p>}

      {!showDetail && !loading && devices.length > 0 ? (
        <table>
          <thead>
            <tr>
              <th>No</th>
              <th>Device Name</th>
              <th>Location</th>
            </tr>
          </thead>
          <tbody>
            {devices.map((item, index) => (
              <tr
                key={item._id}
                className={selectedRow === index ? "bg-blue-100" : ""}
                onClick={() => handleRowClick(index, item)}
                style={{ cursor: "pointer" }}
              >
                <td>{index + 1}</td>
                <td>{item.deviceName || "N/A"}</td>
                <td>{item.location || "N/A"}</td>
              </tr>
            ))}
          </tbody>
        </table>
      ) : showDetail && form ? (
        <div className="form-grid">
          {/* Column 1: Device Name + Location */}
          <div className="form-column">
            <div className="form-input-group">
              <label className="input-label">Device Name *</label>
              <input
                name="deviceName"
                type="text"
                className="form-input"
                placeholder="Enter device name"
                value={form.deviceName || ""}
                onChange={(e) => handleFormChange("deviceName", e.target.value)}
              />
            </div>
            <div className="form-input-group">
              <label className="input-label">Device Location</label>
              <input
                name="location"
                type="text"
                className="form-input"
                placeholder="Enter location"
                value={form.location || ""}
                onChange={(e) => handleFormChange("location", e.target.value)}
              />
            </div>
          </div>

          {/* Column 2: Password + Confirm Password */}
          <div className="form-column">
            <div className="form-input-group">
              <label className="input-label">Password</label>
              <div style={{ position: "relative" }}>
                <input
                  name="password"
                  type={inputType("password")}
                  className="form-input"
                  placeholder="Enter new password (optional)"
                  value={form.password || ""}
                  onChange={(e) => handleFormChange("password", e.target.value)}
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  style={toggleBtnStyle}
                >
                  {showPassword ? "🙈" : "👁"}
                </button>
              </div>
            </div>
            <div className="form-input-group">
              <label className="input-label">Confirm Password</label>
              <div style={{ position: "relative" }}>
                <input
                  name="confirmPassword"
                  type={inputType("confirmPassword")}
                  className="form-input"
                  placeholder="Confirm password"
                  value={confirmPassword}
                  onChange={(e) => setConfirmPassword(e.target.value)}
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  style={toggleBtnStyle}
                >
                  {showPassword ? "🙈" : "👁"}
                </button>
              </div>
            </div>
          </div>

          {/* Column 3: Pin + Confirm Pin */}
          <div className="form-column">
            <div className="form-input-group">
              <label className="input-label">Pin</label>
              <div style={{ position: "relative" }}>
                <input
                  name="pin"
                  type={inputType("pin")}
                  className="form-input"
                  placeholder="Enter new pin (optional)"
                  value={form.pin || ""}
                  onChange={(e) => handleFormChange("pin", e.target.value)}
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  style={toggleBtnStyle}
                >
                  {showPassword ? "🙈" : "👁"}
                </button>
              </div>
            </div>
            <div className="form-input-group">
              <label className="input-label">Confirm Pin</label>
              <div style={{ position: "relative" }}>
                <input
                  name="confirmPin"
                  type={inputType("confirmPin")}
                  className="form-input"
                  placeholder="Confirm pin"
                  value={confirmPin}
                  onChange={(e) => setConfirmPin(e.target.value)}
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  style={toggleBtnStyle}
                >
                  {showPassword ? "🙈" : "👁"}
                </button>
              </div>
            </div>
          </div>

          {/* Column 4: Submit + Feedback + Timestamps */}
          <div className="form-column">
            <div className="form-input-group">
              <button
                type="button"
                onClick={handleSave}
                className="save-button"
                disabled={loading}
              >
                {loading ? "Updating..." : "Update Device"}
              </button>
              <button
                type="button"
                onClick={() => {
                  setShowDetail(false);
                  setConfirmPassword("");
                  setConfirmPin("");
                }}
                className="save-button"
                style={{ marginTop: "10px", backgroundColor: "#6c757d" }}
              >
                Back to List
              </button>
            </div>
            
            <div className="form-input-group" style={{ marginTop: "20px" }}>
              <div style={{ fontSize: "0.9rem", color: "#666" }}>
                <p>
                  <strong>Created:</strong>{" "}
                  {form.createdAt && new Date(form.createdAt).toLocaleString()}
                </p>
                <p>
                  <strong>Updated:</strong>{" "}
                  {form.updatedAt && new Date(form.updatedAt).toLocaleString()}
                </p>
              </div>
            </div>
          </div>
        </div>
      ) : (
        !loading && <p>No devices available.</p>
      )}
    </div>
  );
};

export default EditDeviceAccessCreate;import React, { useEffect, useState, useCallback } from "react";
import { useDispatch, useSelector } from "react-redux";
import { getMachines } from "../../../../redux/create/machine/MachineActions";
import {
  getDeviceAccessList,
  updateDeviceAccess,
  deleteDeviceAccess,
} from "../../../../redux/deviceAccess/deviceAccessActions";
import { RootState } from "../../../../redux/rootReducer";
import { AppDispatch } from "../../../../../store";


interface Device {
  _id: string;
  deviceName: string;
  location: string;
  machines?: Array<{
    machineId: string;
    machineName: string;
    machineType: string;
  }>;
}

const EditDeviceAccess: React.FC = () => {
  const dispatch = useDispatch<AppDispatch>();
  const [selectedRow, setSelectedRow] = useState(0);
  const [showDetail, setShowDetail] = useState(false);
  const [selectedDevice, setSelectedDevice] = useState<Device | null>(null);
  const [machineId, setMachineId] = useState("");

  const { machines: machineList } = useSelector(
    (state: RootState) => state.machineList
  );
  const { devices: deviceList, loading, error } = useSelector(
    (state: RootState) => state.deviceAccess
  );

  const handleKeyDown = useCallback(
    (e: KeyboardEvent) => {
      if (showDetail || deviceList.length === 0) return;

      if (e.key === "ArrowDown") {
        setSelectedRow((prev) => Math.min(prev + 1, deviceList.length - 1));
      } else if (e.key === "ArrowUp") {
        setSelectedRow((prev) => Math.max(prev - 1, 0));
      } else if (e.key === "Enter") {
        const selected = deviceList[selectedRow];
        if (selected) {
          setSelectedDevice(selected);
          setShowDetail(true);
        }
      }
    },
    [deviceList, selectedRow, showDetail]
  );

  useEffect(() => {
    dispatch(getMachines());
    dispatch(getDeviceAccessList());
  }, [dispatch]);

  useEffect(() => {
    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [handleKeyDown]);

  const handleRowClick = (index: number, device: Device) => {
    setSelectedRow(index);
    setSelectedDevice(device);
    setShowDetail(true);
    setMachineId("");
  };

  // ✅ Add/Assign machine
  const handleAddMachine = () => {
    if (!selectedDevice || !machineId) return;

    const selectedMachine = machineList.find((m: any) => m._id === machineId);

    dispatch(
      updateDeviceAccess(selectedDevice._id, "assignMachine", {
        machineId,
        machineName: selectedMachine?.machineName,
        machineType:
          selectedMachine?.machineType?.type || selectedMachine?.machineType,
      })
    ).then(() => {
      dispatch(getDeviceAccessList());
      setMachineId("");
    });
  };

  // ✅ Remove machine
  const handleRemoveMachine = (machineId: string) => {
    if (!selectedDevice) return;
    if (window.confirm("Remove this machine from device?")) {
      dispatch(
        updateDeviceAccess(selectedDevice._id, "removeMachine", { machineId })
      ).then(() => {
        dispatch(getDeviceAccessList());
      });
    }
  };

  // ✅ Delete device
  const handleDeleteDevice = () => {
    if (!selectedDevice) return;
    if (
      window.confirm(
        `Are you sure you want to delete device "${selectedDevice.deviceName}"?`
      )
    ) {
      dispatch(deleteDeviceAccess(selectedDevice._id)).then(() => {
        setShowDetail(false);
        setSelectedDevice(null);
        dispatch(getDeviceAccessList());
      });
    }
  };

  return (
    <div className="device-access-container">
      {!showDetail && !loading && deviceList.length > 0 ? (
        <>
          <h3>Device Access List</h3>
          <table style={{ width: "100%", borderCollapse: "collapse" }}>
            <thead>
              <tr style={{ backgroundColor: "#f5f5f5" }}>
                <th style={{ padding: "10px", textAlign: "left", border: "1px solid #ddd" }}>
                  No
                </th>
                <th style={{ padding: "10px", textAlign: "left", border: "1px solid #ddd" }}>
                  Device Name
                </th>
                <th style={{ padding: "10px", textAlign: "left", border: "1px solid #ddd" }}>
                  Location
                </th>
                <th style={{ padding: "10px", textAlign: "left", border: "1px solid #ddd" }}>
                  Machines
                </th>
              </tr>
            </thead>
            <tbody>
              {deviceList.map((device: Device, index: number) => (
                <tr
                  key={device._id}
                  onClick={() => handleRowClick(index, device)}
                  style={{
                    cursor: "pointer",
                    backgroundColor: selectedRow === index ? "#e3f2fd" : "white",
                  }}
                >
                  <td style={{ padding: "10px", border: "1px solid #ddd" }}>
                    {index + 1}
                  </td>
                  <td style={{ padding: "10px", border: "1px solid #ddd" }}>
                    {device.deviceName}
                  </td>
                  <td style={{ padding: "10px", border: "1px solid #ddd" }}>
                    {device.location || "N/A"}
                  </td>
                  <td style={{ padding: "10px", border: "1px solid #ddd" }}>
                    {device.machines?.length || 0}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </>
      ) : showDetail && selectedDevice ? (
        <div>
          <div style={{ marginBottom: "20px", display: "flex", justifyContent: "space-between", alignItems: "center" }}>
            <h3>Edit Device: {selectedDevice.deviceName}</h3>
            <button
              onClick={() => setShowDetail(false)}
              className="save-button"
              style={{ backgroundColor: "#6c757d" }}
            >
              Back to List
            </button>
          </div>

          {/* Add Machine Section */}
          <div style={{ marginBottom: "30px", padding: "20px", backgroundColor: "#f9f9f9", borderRadius: "8px" }}>
            <h4>Add Machine to Device</h4>
            <div className="form-grid">
              <div className="form-input-group">
                <label className="input-label">Select Machine</label>
                <select
                  value={machineId}
                  onChange={(e) => setMachineId(e.target.value)}
                  className="form-input"
                >
                  <option value="">Select machine</option>
                  {machineList.map((m: any) => (
                    <option key={m._id} value={m._id}>
                      {m.machineName} ({m.machineType?.type || m.machineType})
                    </option>
                  ))}
                </select>

                <button
                  className="save-button"
                  onClick={handleAddMachine}
                  disabled={!machineId || loading}
                  style={{ marginTop: "10px" }}
                >
                  {loading ? "ADDING..." : "ADD MACHINE"}
                </button>
              </div>
            </div>
          </div>

          {/* Assigned Machines Section */}
          <div style={{ marginBottom: "30px" }}>
            <h4>Assigned Machines</h4>
            {selectedDevice.machines && selectedDevice.machines.length > 0 ? (
              <div className="device-grid">
                {selectedDevice.machines.map((machine: any) => (
                  <div key={machine.machineId} className="device-card">
                    <h5>{machine.machineName}</h5>
                    <p>
                      <strong>Type:</strong> {machine.machineType}
                    </p>
                    <button
                      className="remove-button"
                      onClick={() => handleRemoveMachine(machine.machineId)}
                    >
                      Remove Machine
                    </button>
                  </div>
                ))}
              </div>
            ) : (
              <p style={{ color: "#666", fontStyle: "italic" }}>
                No machines assigned to this device.
              </p>
            )}
          </div>

          {/* Device Info Section */}
          <div style={{ padding: "20px", backgroundColor: "#fff3cd", borderRadius: "8px", marginBottom: "20px" }}>
            <h4>Device Information</h4>
            <p>
              <strong>Device Name:</strong> {selectedDevice.deviceName}
            </p>
            <p>
              <strong>Location:</strong> {selectedDevice.location || "N/A"}
            </p>
          </div>

          {/* Delete Device Section */}
          <div style={{ marginTop: "30px", paddingTop: "20px", borderTop: "2px solid #ddd" }}>
            <button
              onClick={handleDeleteDevice}
              className="save-button"
              style={{ backgroundColor: "#dc3545" }}
            >
              DELETE DEVICE
            </button>
            <p style={{ color: "#666", fontSize: "0.9rem", marginTop: "10px" }}>
              ⚠️ Warning: Deleting this device will remove all machine assignments.
            </p>
          </div>

          {error && <div className="error-message" style={{ marginTop: "20px" }}>{error}</div>}
        </div>
      ) : (
        !loading && <p>No devices available.</p>
      )}

      {loading && <p>Loading...</p>}
    </div>
  );
};

export default EditDeviceAccess;import React, { useEffect, useState } from "react";
import { useDispatch, useSelector } from "react-redux";
import {
  listOperators,
  updateOperator,
  deleteOperator,
} from "../../../../redux/create/CreateMachineOpertor/MachineOpertorActions";
import { getMachines } from "../../../../redux/create/machine/MachineActions";
import { RootState } from "../../../../redux/rootReducer";
import { AppDispatch } from "../../../../../store"; // Add this import

interface Operator {
  _id: string;
  username: string;
  machineId: string;
  branchId: {
    name?: string;
  };
}



const EditMachineOpertor: React.FC = () => {
  const dispatch = useDispatch<AppDispatch>(); // Type the dispatch

  const { operators = [], loading, error } = useSelector(
    (state: RootState) => state.operatorList || {}
  );
  const { machines = [] } = useSelector(
    (state: RootState) => state.machineList || {}
  );
  const { success: updateSuccess } = useSelector(
    (state: RootState) => state.operatorUpdate || {}
  );
  const { success: deleteSuccess } = useSelector(
    (state: RootState) => state.operatorDelete || {}
  );

  const [focusedRow, setFocusedRow] = useState<number>(-1);
  const [selectedOperator, setSelectedOperator] = useState<Operator | null>(null);
  const [editForm, setEditForm] = useState({
    username: "",
    password: "",
    confirmPassword: "",
    machineId: "",
  });

  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const [deleteInput, setDeleteInput] = useState("");

  useEffect(() => {
    dispatch(listOperators());
    dispatch(getMachines());
  }, [dispatch, updateSuccess, deleteSuccess]);

  const handleKeyDown = (
    e: React.KeyboardEvent<HTMLTableRowElement>,
    operator: Operator
  ) => {
    if (e.key === "Enter") openEditor(operator);
    else if (e.key === "ArrowDown")
      setFocusedRow((prev) => Math.min(prev + 1, operators.length - 1));
    else if (e.key === "ArrowUp")
      setFocusedRow((prev) => Math.max(prev - 1, 0));
  };

  const openEditor = (operator: Operator) => {
    setSelectedOperator(operator);
    setEditForm({
      username: operator.username,
      password: "",
      confirmPassword: "",
      machineId: operator.machineId || "",
    });
  };

  const handleEditChange = (field: keyof typeof editForm, value: string) => {
    setEditForm((prev) => ({ ...prev, [field]: value }));
  };

  const handleUpdate = () => {
    if (!selectedOperator) return;
    if (editForm.password !== editForm.confirmPassword) {
      alert("❌ Password and Confirm Password do not match");
      return;
    }

    const payload: any = {
      username: editForm.username,
      machineId: editForm.machineId,
    };

    if (editForm.password.trim()) {
      payload.password = editForm.password;
    }

    dispatch(updateOperator(selectedOperator._id, payload));
    setSelectedOperator(null);
  };

  const handleDeleteClick = () => {
    setDeleteInput("");
    setShowDeleteConfirm(true);
  };

  const confirmDelete = () => {
    if (deleteInput === "DELETE" && selectedOperator) {
      dispatch(deleteOperator(selectedOperator._id));
      setShowDeleteConfirm(false);
      setSelectedOperator(null);
    } else {
      alert("❌ Type DELETE to confirm deletion");
    }
  };

  const cancelDelete = () => setShowDeleteConfirm(false);

  return (
    <div className="EditOperators p-4">
      <h2 className="text-xl font-semibold mb-4">Machine Operators</h2>

      {loading && <p>Loading...</p>}
      {error && <p className="text-red-500">{error}</p>}

      {!selectedOperator ? (
        <table className="w-full border border-collapse">
          <thead className="bg-gray-200">
            <tr>
              <th className="p-2 border">Username</th>
              <th className="p-2 border">Machine</th>
              <th className="p-2 border">Branch ID</th>
            </tr>
          </thead>
          <tbody>
            {operators.map((operator, index) => (
              <tr
                key={operator._id}
                tabIndex={0}
                onClick={() => openEditor(operator)}
                onKeyDown={(e) => handleKeyDown(e, operator)}
                onFocus={() => setFocusedRow(index)}
                className={`cursor-pointer hover:bg-gray-50 ${
                  focusedRow === index ? "bg-blue-100" : ""
                }`}
              >
                <td className="p-2 border">{operator.username}</td>
                <td className="p-2 border">
                  {machines.find((m) => m._id === operator.machineId)?.machineName || "—"}
                </td>
                <td className="p-2 border">{operator.branchId?.name || "—"}</td>
              </tr>
            ))}
          </tbody>
        </table>
      ) : (
        <div className="bg-white p-4 shadow-md rounded max-w-lg">
          <h3 className="text-lg font-bold mb-2">Edit Operator</h3>

          <label className="block mb-1">Username</label>
          <input
            value={editForm.username}
            onChange={(e) => handleEditChange("username", e.target.value)}
            className="border p-2 mb-3 w-full"
          />

          <label className="block mb-1">Password (leave blank to keep current)</label>
          <input
            type="password"
            value={editForm.password}
            onChange={(e) => handleEditChange("password", e.target.value)}
            className="border p-2 mb-3 w-full"
          />

          <label className="block mb-1">Confirm Password</label>
          <input
            type="password"
            value={editForm.confirmPassword}
            onChange={(e) => handleEditChange("confirmPassword", e.target.value)}
            className="border p-2 mb-3 w-full"
          />

          <label className="block mb-1">Assigned Machine</label>
          <select
            value={editForm.machineId}
            onChange={(e) => handleEditChange("machineId", e.target.value)}
            className="border p-2 mb-3 w-full"
          >
            <option value="">Select Machine</option>
            {machines.map((m) => (
              <option key={m._id} value={m._id}>
                {m.machineName}
              </option>
            ))}
          </select>

          <div className="flex gap-3 mt-4">
            <button
              onClick={handleUpdate}
              className="bg-green-600 text-white px-4 py-2 rounded"
            >
              Save
            </button>
            <button
              onClick={handleDeleteClick}
              className="bg-red-500 text-white px-4 py-2 rounded"
            >
              Delete
            </button>
            <button
              onClick={() => setSelectedOperator(null)}
              className="bg-gray-400 text-white px-4 py-2 rounded"
            >
              Cancel
            </button>
          </div>
        </div>
      )}

      {showDeleteConfirm && (
        <div className="fixed inset-0 bg-black/40 flex justify-center items-center z-50">
          <div className="bg-white p-6 rounded shadow-lg max-w-sm w-full text-center">
            <h3 className="text-lg font-bold mb-4">
              Type <span className="text-red-600 font-mono">DELETE</span> to confirm
            </h3>
            <input
              type="text"
              value={deleteInput}
              onChange={(e) => setDeleteInput(e.target.value)}
              className="border p-2 w-full mb-4"
              placeholder="Type DELETE to confirm"
            />
            <div className="flex justify-center gap-4">
              <button
                onClick={confirmDelete}
                className="bg-red-600 text-white px-4 py-2 rounded"
              >
                Confirm
              </button>
              <button
                onClick={cancelDelete}
                className="bg-gray-400 text-white px-4 py-2 rounded"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default EditMachineOpertor;import React, { useEffect, useState } from "react";
import { useDispatch, useSelector } from "react-redux";
import { RootState } from "../../../../redux/rootReducer";
import { AppDispatch } from "../../../../../store";
import {
  getSteps,
  updateStep,
  deleteStep,
} from "../../../../redux/create/CreateStep/StpeActions";
import { getMachines } from "../../../../redux/create/machine/MachineActions";

// Define interfaces for type safety
interface Machine {
  _id: string;
  machineName: string;
  machineType: string | { type: string } | null;
}

interface StepMachine {
  machineId: string | { _id: string };
  sequence?: number;
}

interface Step {
  _id: string;
  stepName: string;
  machines?: StepMachine[];
  branchId?: {
    name: string;
  };
}

interface EditFormMachine {
  machineId: string;
}

interface EditForm {
  stepName: string;
  machines: EditFormMachine[];
}

// Remove the StepListState interface since we'll handle typing differently

const EditStep: React.FC = () => {
  const dispatch = useDispatch<AppDispatch>();
  const [focusedRow, setFocusedRow] = useState<number>(-1);
  const [selectedStep, setSelectedStep] = useState<Step | null>(null);
  const [editForm, setEditForm] = useState<EditForm>({
    stepName: "",
    machines: [{ machineId: "" }],
  });
  const [deleteConfirm, setDeleteConfirm] = useState(false);
  const [deleteInput, setDeleteInput] = useState("");

  const stepListState = useSelector((state: RootState) => state.stepList) as any;
  const steps: Step[] = stepListState?.steps?.steps || stepListState?.steps || [];
  const updateSuccess = stepListState?.success;

  const machineListState = useSelector((state: RootState) => state.machineList) as any;
  const machines: Machine[] = machineListState?.machines || [];

  useEffect(() => {
    dispatch(getSteps());
    dispatch(getMachines());
  }, [dispatch, updateSuccess]);

  const openEditor = (step: Step) => {
    setSelectedStep(step);
    setEditForm({
      stepName: step.stepName || "",
      machines:
        step.machines?.map((m: StepMachine) => ({
          machineId: typeof m.machineId === 'object' ? m.machineId._id : m.machineId,
        })) || [{ machineId: "" }],
    });
  };

  const handleEditChange = (index: number, value: string) => {
    const updated = [...editForm.machines];
    updated[index].machineId = value;
    setEditForm((prev) => ({ ...prev, machines: updated }));
  };

  const handleAddMachine = () => {
    setEditForm((prev) => ({
      ...prev,
      machines: [...prev.machines, { machineId: "" }],
    }));
  };

  const handleRemoveMachine = (index: number) => {
    if (editForm.machines.length <= 1) return;
    const updated = editForm.machines.filter((_, i) => i !== index);
    setEditForm((prev) => ({ ...prev, machines: updated }));
  };

  const handleUpdate = () => {
    if (!selectedStep) return;

    const machinesFiltered = editForm.machines.filter((m) => m.machineId);

    if (!editForm.stepName.trim()) {
      alert("Step name is required");
      return;
    }
    if (machinesFiltered.length === 0) {
      alert("At least one machine is required");
      return;
    }

    const updatedStep = {
      stepName: editForm.stepName,
      machines: machinesFiltered.map((m, i) => ({
        machineId: m.machineId,
        sequence: i + 1,
      })),
    };

    dispatch(updateStep(selectedStep._id, updatedStep));
    setSelectedStep(null);
  };

  const confirmDelete = () => {
    if (deleteInput === "DELETE" && selectedStep) {
      dispatch(deleteStep(selectedStep._id));
      setDeleteConfirm(false);
      setSelectedStep(null);
    } else {
      alert("❌ Type DELETE to confirm");
    }
  };

  return (
    <div className="edit-step-container p-4">
      <h2 className="text-xl font-bold mb-4">Edit Production Steps</h2>

      {!selectedStep ? (
        <table className="w-full border border-collapse">
          <thead className="bg-gray-200">
            <tr>
              <th className="p-2 border">Step Name</th>
              <th className="p-2 border">Total Machines</th>
              <th className="p-2 border">Branch</th>
            </tr>
          </thead>
          <tbody>
            {steps.map((step: Step, index: number) => (
              <tr
                key={step._id}
                tabIndex={0}
                onClick={() => openEditor(step)}
                onFocus={() => setFocusedRow(index)}
                className={focusedRow === index ? "bg-blue-100" : ""}
              >
                <td className="p-2 border">{step.stepName}</td>
                <td className="p-2 border">{step.machines?.length || 0}</td>
                <td className="p-2 border">{step.branchId?.name || "—"}</td>
              </tr>
            ))}
          </tbody>
        </table>
      ) : (
        <div className="bg-white p-4 shadow-md rounded max-w-xl">
          <h3 className="text-lg font-semibold mb-2">Edit Step</h3>

          <label className="block mb-1">Step Name *</label>
          <input
            value={editForm.stepName}
            onChange={(e) =>
              setEditForm((prev) => ({ ...prev, stepName: e.target.value }))
            }
            className="border p-2 w-full mb-3"
          />

          <label className="block mb-1">Machines *</label>
          {editForm.machines.map((machine: EditFormMachine, index: number) => (
            <div key={index} className="flex items-center mb-2 gap-2">
              <select
                value={machine.machineId}
                onChange={(e) => handleEditChange(index, e.target.value)}
                className="border p-2 w-full"
              >
                <option value="">Select Machine</option>
                {machines.map((m: Machine) => {
                  let machineTypeDisplay = 'Unknown';
                  
                  if (m.machineType) {
                    if (typeof m.machineType === 'object' && m.machineType.type) {
                      machineTypeDisplay = m.machineType.type;
                    } else if (typeof m.machineType === 'string') {
                      machineTypeDisplay = m.machineType;
                    }
                  }
                  
                  return (
                    <option key={m._id} value={m._id}>
                      {m.machineName} ({machineTypeDisplay})
                    </option>
                  );
                })}
              </select>
              {editForm.machines.length > 1 && (
                <button
                  type="button"
                  onClick={() => handleRemoveMachine(index)}
                  className="text-red-600 font-bold"
                >
                  ×
                </button>
              )}
            </div>
          ))}
          <button
            type="button"
            onClick={handleAddMachine}
            className="text-blue-600 mb-4"
          >
            + Add Machine
          </button>

          <div className="flex gap-3 mt-4">
            <button
              onClick={handleUpdate}
              className="bg-green-600 text-white px-4 py-2 rounded"
            >
              Update
            </button>
            <button
              onClick={() => setDeleteConfirm(true)}
              className="bg-red-500 text-white px-4 py-2 rounded"
            >
              Delete
            </button>
            <button
              onClick={() => setSelectedStep(null)}
              className="bg-gray-500 text-white px-4 py-2 rounded"
            >
              Cancel
            </button>
          </div>
        </div>
      )}

      {deleteConfirm && (
        <div className="fixed inset-0 bg-black/40 flex justify-center items-center z-50">
          <div className="bg-white p-6 rounded shadow-lg max-w-sm w-full text-center">
            <h3 className="text-lg font-bold mb-4">
              Type <span className="text-red-600 font-mono">DELETE</span> to confirm deletion
            </h3>
            <input
              type="text"
              value={deleteInput}
              onChange={(e) => setDeleteInput(e.target.value)}
              className="border p-2 w-full mb-4"
              placeholder="DELETE"
            />
            <div className="flex justify-center gap-4">
              <button
                onClick={confirmDelete}
                className="bg-red-600 text-white px-4 py-2 rounded"
              >
                Confirm
              </button>
              <button
                onClick={() => setDeleteConfirm(false)}
                className="bg-gray-400 text-white px-4 py-2 rounded"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default EditStep;


const UpdataIDAndPassword = () => {
    return (
        <div>
            Heloo
        </div>
    )
}




export default UpdataIDAndPassword;
import React, { useEffect, useState, useCallback } from "react";
import { useDispatch, useSelector } from "react-redux";
import {
  getAccounts,
  updateAccount,
} from "../../../../redux/create/createNewAccount/NewAccountActions";
import { RootState } from "../../../../redux/rootReducer";
import { AppDispatch } from "../../../../../store";
import { indianStates } from "../../create/createNewAccount/indianStates";
import "./EditAccount.css";

interface Account {
  _id: string;
  companyName?: string;
  firstName?: string;
  lastName?: string;
  email?: string;
  phone1?: string;
  phone2?: string;
  whatsapp?: string;
  telephone?: string;
  address1?: string;
  address2?: string;
  state?: string;
  pinCode?: string;
  imageUrl?: string;
  createdAt?: string;
  updatedAt?: string;
}

const EditAccount: React.FC = () => {
  const dispatch = useDispatch<AppDispatch>();

  const { accounts = [], loading, error } = useSelector(
    (state: RootState) => state.getAccounts || {}
  );

  const [selectedRow, setSelectedRow] = useState(0);
  const [showDetail, setShowDetail] = useState(false);
  const [form, setForm] = useState<Partial<Account>>({});

  const handleKeyDown = useCallback(
    (e: KeyboardEvent) => {
      if (showDetail || accounts.length === 0) return;

      if (e.key === "ArrowDown") {
        setSelectedRow((prev) => Math.min(prev + 1, accounts.length - 1));
      } else if (e.key === "ArrowUp") {
        setSelectedRow((prev) => Math.max(prev - 1, 0));
      } else if (e.key === "Enter") {
        const selected = accounts[selectedRow];
        if (selected) {
          setForm(selected);
          setShowDetail(true);
        }
      }
    },
    [accounts, selectedRow, showDetail]
  );

  useEffect(() => {
    dispatch(getAccounts());
  }, [dispatch]);

  useEffect(() => {
    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [handleKeyDown]);

  const handleFormChange = (key: keyof Account, value: string) => {
    setForm((prev) => ({ ...prev, [key]: value }));
  };

  const handleSave = async () => {
    if (!form._id) return;
    try {
      await dispatch(updateAccount(form._id, form));
      alert("Account updated successfully!");
      setShowDetail(false);
      dispatch(getAccounts());
    } catch (err) {
      alert("Failed to update account.");
    }
  };

  const handleRowClick = (index: number, item: Account) => {
    setSelectedRow(index);
    setForm(item);
    setShowDetail(true);
  };

  return (
    <div className="EditAccount EditMachineType">
       {loading && <p className="loadingAndError">Loading...</p>}
      {error && <p className="loadingAndError"  style={{ color: "red" }}>{error}</p>}

      {!showDetail && !loading && accounts.length > 0 ? (
        <table>
          <thead>
            <tr>
              <th>No</th>
              <th>Company</th>
              <th>Name</th>
              <th>Phone</th>
              <th>State</th>
            </tr>
          </thead>
          <tbody>
            {accounts.map((item, index) => (
              <tr
                key={item._id}
                className={selectedRow === index ? "bg-blue-100" : ""}
                onClick={() => handleRowClick(index, item)}
                style={{ cursor: "pointer" }}
              >
                <td>{index + 1}</td>
                <td>{item.companyName || "N/A"}</td>
                <td>
                  {[item.firstName, item.lastName].filter(Boolean).join(" ") ||
                    "N/A"}
                </td>
                <td>{item.phone1 || "N/A"}</td>
                <td>{item.state || "N/A"}</td>
              </tr>
            ))}
          </tbody>
        </table>
      ) : showDetail && form ? (
        <div id="CreateAccountCss">
          <div className="CreateAccountTitelCss">
            <h6>Edit Account</h6>
          </div>
          <div className="create-account-container">
            <form className="form-container">
              <div className="form-group">
                <label>Company Name</label>
                <input
                  className="CurstomerAddressInput"
                  name="companyName"
                  value={form.companyName || ""}
                  onChange={(e) => handleFormChange("companyName", e.target.value)}
                />
              </div>

              <div className="form-row">
                <div className="form-group">
                  <label>First Name *</label>
                  <input
                    className="CurstomerInput"
                    name="firstName"
                    value={form.firstName || ""}
                    onChange={(e) => handleFormChange("firstName", e.target.value)}
                  />
                </div>
                <div className="form-group">
                  <label>Last Name *</label>
                  <input
                    className="CurstomerInput"
                    name="lastName"
                    value={form.lastName || ""}
                    onChange={(e) => handleFormChange("lastName", e.target.value)}
                  />
                </div>
              </div>

              <div className="form-group">
                <label>Email</label>
                <input
                  className="CurstomerAddressInput"
                  type="email"
                  name="email"
                  value={form.email || ""}
                  onChange={(e) => handleFormChange("email", e.target.value)}
                />
              </div>

              <div className="form-row">
                <div className="form-group">
                  <label>Phone 1 *</label>
                  <input
                    className="CurstomerInput"
                    name="phone1"
                    value={form.phone1 || ""}
                    onChange={(e) => handleFormChange("phone1", e.target.value)}
                  />
                </div>
                <div className="form-group">
                  <label>Phone 2</label>
                  <input
                    className="CurstomerInput"
                    name="phone2"
                    value={form.phone2 || ""}
                    onChange={(e) => handleFormChange("phone2", e.target.value)}
                  />
                </div>
                <div className="form-group">
                  <label>WhatsApp</label>
                  <input
                    className="CurstomerInput"
                    name="whatsapp"
                    value={form.whatsapp || ""}
                    onChange={(e) => handleFormChange("whatsapp", e.target.value)}
                  />
                </div>
                <div className="form-group">
                  <label>Telephone</label>
                  <input
                    className="CurstomerInput"
                    name="telephone"
                    value={form.telephone || ""}
                    onChange={(e) => handleFormChange("telephone", e.target.value)}
                  />
                </div>
              </div>

              <div className="form-row">
                
              </div>

              <div className="form-group">
                <label>Address Line 1 *</label>
                <input
                  name="address1"
                  className="CurstomerAddressInput"
                  value={form.address1 || ""}
                  onChange={(e) => handleFormChange("address1", e.target.value)}
                />
              </div>

              <div className="form-group">
                <label>Address Line 2</label>
                <input
                  name="address2"
                  className="CurstomerAddressInput"
                  value={form.address2 || ""}
                  onChange={(e) => handleFormChange("address2", e.target.value)}
                />
              </div>

              <div className="form-row">
                <div className="form-group">
                  <label>State *</label>
                  <select
                    name="state"
                    value={form.state || ""}
                    onChange={(e) => handleFormChange("state", e.target.value)}
                  >
                    <option value="">Select State</option>
                    {indianStates.map((state) => (
                      <option key={state} value={state}>
                        {state}
                      </option>
                    ))}
                  </select>
                </div>

                <div className="form-group">
                  <label>Pin Code *</label>
                  <input
                    name="pinCode"
                    className="CurstomerInput"
                    value={form.pinCode || ""}
                    onChange={(e) => handleFormChange("pinCode", e.target.value)}
                  />
                </div>
              </div>

              {form.imageUrl && (
                <div className="form-group">
                  <label>Profile Image</label>
                  <div className="image-preview">
                    <img
                      src={form.imageUrl}
                      alt="Account"
                      style={{ maxWidth: '200px', maxHeight: '200px' }}
                    />
                  </div>
                </div>
              )}

              <div className="form-group">
                <button type="button" onClick={handleSave}>
                  Update Account
                </button>
                <button type="button" onClick={() => setShowDetail(false)} style={{ marginLeft: '10px' }}>
                  Back
                </button>
              </div>

              <div className="info-section">
                <p>
                  <strong>Created:</strong>{" "}
                  {form.createdAt && new Date(form.createdAt).toLocaleString()}
                </p>
                <p>
                  <strong>Updated:</strong>{" "}
                  {form.updatedAt && new Date(form.updatedAt).toLocaleString()}
                </p>
              </div>
            </form>
          </div>
        </div>
      ) : (
        !loading && <p>No accounts available.</p>
      )}
    </div>
  );
};

export default EditAccount;
import EditIndex from "../EditIndex";
import './indexEdit.css'
import { Route, Routes } from "react-router-dom";
import EditMachineOpertor from "../EditMachineOpertor/EditMachineOPertor";
import EditNewAccount from "../EditNewAccount/EditNewAccount";
import EditMaterials from "../EditMaterials/EditMaterials";
import EditProduct from "../EditProducts/EditProduct";
import EditProductCategoris from "../EditProducts/EditProductCategoris";
import EditStep from "../EditCreateStep/EditStep";




const IndexEdit =  () =>{
     return(
        <Routes>
            <Route path="/" element={<EditIndex/>} />
            <Route path ="/editNewAccount" element={<EditNewAccount/>} />
            <Route path='/editProduct' element={<EditProduct/>} />
            <Route path='/editProductCategories' element={<EditProductCategoris/>} />
            <Route path='/editStep' element={<EditStep/>} />
          
            <Route path="editMaterials" element={<EditMaterials/>} />

            <Route path="editMachine" element={<h1>Edit Machine</h1>} />
            <Route path="/editMachineCategories" element={<EditMachineOpertor/>} />

        </Routes>     
        )
}


export default IndexEdit;import React, { useEffect, useState, useCallback } from "react";
import "./EditMachineyType.css";
import { useDispatch, useSelector } from "react-redux";
import {
  getAllMachineTypes,
  updateMachineType,
  deleteMachineType,
} from "../../../../redux/create/machineType/machineTypeActions";
import { RootState } from "../../../../redux/rootReducer";
import { AppDispatch } from "../../../../../store";

interface Branch {
  _id: string;
  name: string;
  location?: string;
}

interface Machine {
  _id: string;
  machineName: string;
  sizeX: string;
  sizeY: string;
  sizeZ: string;
  branchId?: Branch;
}

interface MachineType {
  _id: string;
  type: string;
  description: string;
  machines: Machine[];
  createdAt: string;
  updatedAt: string;
  branchId: {
    _id: string;
    name: string;
  };
}

const EditMachineType: React.FC = () => {
  const dispatch = useDispatch<AppDispatch>();
  const { items: machineTypes = [], loading, error } = useSelector(
    (state: RootState) => state.machineTypeList || {}
  );

  const [selectedRow, setSelectedRow] = useState(0);
  const [showDetail, setShowDetail] = useState(false);
  const [editType, setEditType] = useState("");
  const [editDescription, setEditDescription] = useState("");
  const [editId, setEditId] = useState<string | null>(null);

  const selectedItem = machineTypes[selectedRow];

  const handleKeyDown = useCallback(
    (e: KeyboardEvent) => {
      if (showDetail || machineTypes.length === 0) return;

      if (e.key === "ArrowDown") {
        setSelectedRow((prev) => Math.min(prev + 1, machineTypes.length - 1));
      } else if (e.key === "ArrowUp") {
        setSelectedRow((prev) => Math.max(prev - 1, 0));
      } else if (e.key === "Enter") {
        const selected = machineTypes[selectedRow];
        if (selected) {
          setEditId(selected._id);
          setEditType(selected.type);
          setEditDescription(selected.description);
          setShowDetail(true);
        }
      }
    },
    [machineTypes, selectedRow, showDetail]
  );

  useEffect(() => {
    dispatch(getAllMachineTypes());
  }, [dispatch]);

  useEffect(() => {
    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [handleKeyDown]);

  const handleEditSave = async () => {
    if (!editType.trim()) {
      alert("Type cannot be empty");
      return;
    }

    if (!editId) return;

    try {
      await dispatch(updateMachineType(editId, editType, editDescription));
      alert("Machine Type updated successfully!");
      setShowDetail(false);
      dispatch(getAllMachineTypes()); // Refresh list
    } catch (err) {
      alert("Failed to update Machine Type.");
    }
  };

  const handleDelete = async () => {
    if (!editId) return;

    if (!window.confirm("Are you sure you want to delete this machine type?"))
      return;

    try {
      await dispatch(deleteMachineType(editId));
      alert("Deleted successfully.");
      setShowDetail(false);
      dispatch(getAllMachineTypes());
    } catch (err) {
      alert("Failed to delete.");
    }
  };

  const handleRowClick = (index: number, item: MachineType) => {
    setSelectedRow(index);
    setEditId(item._id);
    setEditType(item.type);
    setEditDescription(item.description);
    setShowDetail(true);
  };

  return (
    <div className="EditMachineType">
       {loading && <p className="loadingAndError">Loading...</p>}
      {error && <p className="loadingAndError"  style={{ color: "red" }}>{error}</p>}

      {!showDetail && !loading && machineTypes.length > 0 ? (
        <table>
          <thead>
            <tr>
              <th>No</th>
              <th>Machine Type</th>
              <th>Total Machines</th>
              <th>Branch</th>
              <th>Created</th>
              <th>Updated</th>
              <th>Edit</th>
            </tr>
          </thead>
          <tbody>
            {machineTypes.map((item: MachineType, index: number) => (
              <tr
                key={item._id}
                className={selectedRow === index ? "bg-blue-100" : ""}
              >
                <td>{index + 1}</td>
                <td>{item.type}</td>
                <td>{item.machines?.length ?? 0}</td>
                <td>{item.branchId?.name || "N/A"}</td>
                <td>{new Date(item.createdAt).toLocaleString()}</td>
                <td>{new Date(item.updatedAt).toLocaleString()}</td>
                <td
                  className="text-blue-600 emt-edit-text"
                  onClick={() => handleRowClick(index, item)}
                >
                  Edit
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      ) : showDetail && selectedItem ? (
        <div className="detail-container">
          <div className="TopButtonEdit">
            <button onClick={() => setShowDetail(false)}>Back</button>
            <button onClick={handleDelete} className="Delete">
              Delete
            </button>
          </div>

          <div className="form-section">
            <label>Machine Type:</label>
            <input
              type="text"
              value={editType}
              onChange={(e) => setEditType(e.target.value)}
            />
          </div>

          <div className="form-section">
            <label>Description:</label>
            <textarea
              value={editDescription}
              onChange={(e) => setEditDescription(e.target.value)}
              rows={3}
            />
          </div>

          <button
            onClick={handleEditSave}
            className="save-button"
            disabled={
              editType === selectedItem.type &&
              editDescription === selectedItem.description
            }
          >
            Save
          </button>

          <div className="info-section">
            <p>
              <strong>Total Machines:</strong>{" "}
              {selectedItem?.machines?.length ?? 0}
            </p>
            <p>
              <strong>Branch:</strong> {selectedItem.branchId?.name || "N/A"}
            </p>
            <p>
              <strong>Created At:</strong>{" "}
              {new Date(selectedItem.createdAt).toLocaleString()}
            </p>
            <p>
              <strong>Updated At:</strong>{" "}
              {new Date(selectedItem.updatedAt).toLocaleString()}
            </p>
          </div>

          <table className="machine-details-table">
            <thead>
              <tr>
                <th>Machine Name</th>
                <th>Size X</th>
                <th>Size Y</th>
                <th>Size Z</th>
                <th>Branch</th>
              </tr>
            </thead>
            <tbody>
              {selectedItem?.machines.map((m: Machine, idx: number) => (
                <tr key={idx}>
                  <td>{m.machineName}</td>
                  <td>{m.sizeX}</td>
                  <td>{m.sizeY}</td>
                  <td>{m.sizeZ}</td>
                  <td>{m.branchId?.name || "N/A"}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      ) : (
        !loading && <p>No machine types available.</p>
      )}
    </div>
  );
};

export default EditMachineType;.EditMachineType{
   width: 100%;
 
    height: 100vh;
}/* EditMachineType Component Styles */
.EditMachineType {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  max-width: 1200px;
  margin: 0 auto;

  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);

  min-height: 500px;
}


.EditMachineType table {
  width: 100%;
  border-collapse: collapse;

  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
  margin-top: 16px;
}

.EditMachineType thead {
  border-bottom:  1px solid #ccc;
  color: rgb(0, 0, 0);
}

.EditMachineType thead th {
  padding: 16px 20px;
  font-weight: 600;
  text-align: left;
  font-size: 14px;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  border: none;
}

.EditMachineType tbody td {
  padding: 14px 20px;
  border-bottom: 1px solid #e2e8f0;
  color: #374151;
  font-size: 14px;
  transition: all 0.2s ease;
}

.EditMachineType tbody tr:last-child td {
  border-bottom: none;
}

.EditMachineType tbody tr {
  transition: all 0.3s ease;
  cursor: pointer;
}

.EditMachineType tbody tr:hover {
  background: #f8fafc;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* Selected Row Styling */
.EditMachineType tbody tr.bg-blue-100 {
  background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
  border-left: 4px solid #3b82f6;
  font-weight: 600;
  color: #1e40af;
}

.EditMachineType tbody tr.bg-blue-100:hover {
  background: linear-gradient(135deg, #bfdbfe 0%, #93c5fd 100%);
}

/* Edit Column Styling */
.EditMachineType .text-blue-600 {
  color: #3b82f6;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  padding: 6px 12px;
  border-radius: 4px;
  display: inline-block;
}

.EditMachineType .text-blue-600:hover {
  background: #dbeafe;
  color: #1d4ed8;
  transform: scale(1.05);
}

/* Detail View Styles */
.EditMachineType .detail-container {
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Back Button */
.EditMachineType button:first-child {
  background: none;

  color:black;
  border: none;
   border-bottom: 1px solid #000;
  padding: 12px 20px;

  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
 
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 24px;
}

.EditMachineType button:first-child:hover {
  border-bottom: linear-gradient(135deg, #4b5563 0%, #374151 100%);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Form Section */
.EditMachineType .form-section {
  background: #f8fafc;
  padding: 20px;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
  margin-bottom: 24px;
  display: flex;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
}

.EditMachineType .form-section label {
  font-weight: 600;
  color: #374151;
  font-size: 14px;
  white-space: nowrap;
}

.EditMachineType .form-section input {
  border: 2px solid #d1d5db;
  padding: 10px 14px;
  border-radius: 6px;
  font-size: 14px;
  transition: all 0.2s ease;
  min-width: 200px;
  background: white;
}

.EditMachineType .form-section input:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  transform: scale(1.02);
}

/* Save Button */
.EditMachineType .save-button {
    width: 100px;
  background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2);
}
.Delete{
 background-color: red;
  color: #000;
    width: 100px;
     padding: 10px 20px;
  border-radius: 6px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
 

}

.EditMachineType .save-button:hover {
  background: linear-gradient(135deg, #1d4ed8 0%, #1e3a8a 100%);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

/* Info Section */
.EditMachineType .info-section {
  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
  padding: 16px 20px;
  border-radius: 8px;
  border-left: 4px solid #0ea5e9;
  margin-bottom: 20px;
}

.EditMachineType .info-section p {
  margin: 0;
  color: #0c4a6e;
  font-weight: 500;
}

/* Machine Details Table */
.EditMachineType .machine-details-table {
  margin-top: 20px;
}

.EditMachineType .machine-details-table thead {
  background: linear-gradient(135deg, #059669 0%, #047857 100%);
}

.EditMachineType .machine-details-table tbody tr:hover {
  background: #ecfdf5;
}

/* Responsive Design */
@media (max-width: 768px) {
  .EditMachineType {
    padding: 16px;
    margin: 10px;
    border-radius: 8px;
  }
  
  .EditMachineType table {
    font-size: 12px;
  }
  
  .EditMachineType thead th,
  .EditMachineType tbody td {
    padding: 10px 12px;
  }
  
  .EditMachineType .form-section {
    flex-direction: column;
    align-items: stretch;
  }
  
  .EditMachineType .form-section input {
    min-width: auto;
  }
}

@media (max-width: 480px) {
  .EditMachineType {
    padding: 12px;
  }
  
  .EditMachineType table {
    font-size: 11px;
  }
  
  .EditMachineType thead th,
  .EditMachineType tbody td {
    padding: 8px 10px;
  }
}

/* Loading Animation */
.EditMachineType.loading {
  opacity: 0.7;
  pointer-events: none;
}

.EditMachineType.loading::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 40px;
  height: 40px;
  border: 4px solid #f3f3f3;
  border-top: 4px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  transform: translate(-50%, -50%);
}

@keyframes spin {
  0% { transform: translate(-50%, -50%) rotate(0deg); }
  100% { transform: translate(-50%, -50%) rotate(360deg); }
}

/* Focus Management */
.EditMachineType:focus-within {
  box-shadow: 0 4px 25px rgba(59, 130, 246, 0.15);
}

/* Accessibility Improvements */
.EditMachineType button:focus,
.EditMachineType input:focus {
  outline: 2px solid #3b82f6;
  outline-offset: 2px;
}

.EditMachineType tbody tr:focus {
  outline: 2px solid #3b82f6;
  outline-offset: -2px;
}




.mb-3{
   display: flex;
   flex-direction: column;
   gap: 10px;

}




.TopButtonEdit{
    display: flex;
    flex-direction: row;
    justify-content: space-between;
}


.emt-edit-text {
  cursor: pointer;
}

.EditMachineType table {
  width: 100%;
  border-collapse: collapse;
}

.EditMachineType th,
.EditMachineType td {
  border: 1px solid #ddd;
  padding: 8px;
}

.bg-blue-100 {
  background-color: #ebf8ff;
}

.detail-container {
  padding: 16px;
  border: 1px solid #ccc;
}

.TopButtonEdit {
  display: flex;
  justify-content: space-between;
  margin-bottom: 16px;
}

.save-button,
.Delete {
  margin-left: 8px;
  padding: 6px 12px;
  cursor: pointer;
}